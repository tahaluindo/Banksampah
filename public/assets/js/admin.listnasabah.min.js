let arrayWilayah=[];const getAllWilayah=async()=>{let a=await httpRequestGet(`${APIURL}/nasabah/wilayah`),t=[],e='<option value="">-- semua wilayah --</option>';200===a.status&&(arrayWilayah=a.data.data,arrayWilayah.forEach(a=>{t.includes(a.provinsi)||(t.push(a.provinsi),e+=`<option value="${a.provinsi}" data-provinsi="${a.provinsi}">${a.provinsi}</option>`)})),$("select[name=provinsi]").html(e)};getAllWilayah(),$("select[name=provinsi]").on("change",function(){let a=[],t='<option value="">-- pilih kota --</option>';""!=$(this).val()?($("select[name=kota]").removeAttr("disabled"),arrayWilayah.forEach(e=>{e.provinsi==$(this).val()&&(a.includes(e.kota)||(a.push(e.kota),t+=`<option value="${e.kota}">${e.kota}</option>`))}),$("select[name=kota]").html(t)):$("select[name=kota]").attr("disabled",!0),$("select[name=kota]").val(""),$("select[name=kecamatan]").val(""),$("select[name=kecamatan]").attr("disabled",!0),$("select[name=kelurahan]").val(""),$("select[name=kelurahan]").attr("disabled",!0)}),$("select[name=kota]").on("change",function(){let a=[],t='<option value="">-- pilih kecamatan --</option>';""!=$(this).val()?($("select[name=kecamatan]").removeAttr("disabled"),arrayWilayah.forEach(e=>{e.kota==$(this).val()&&(a.includes(e.kecamatan)||(a.push(e.kecamatan),t+=`<option value="${e.kecamatan}">${e.kecamatan}</option>`))}),$("select[name=kecamatan]").html(t)):$("select[name=kecamatan]").attr("disabled",!0),$("select[name=kecamatan]").val(""),$("select[name=kelurahan]").val(""),$("select[name=kelurahan]").attr("disabled",!0)}),$("select[name=kecamatan]").on("change",function(){let a=[],t='<option value="">-- pilih kelurahan --</option>';""!=$(this).val()?($("select[name=kelurahan]").removeAttr("disabled"),arrayWilayah.forEach(e=>{e.kecamatan==$(this).val()&&(a.includes(e.kelurahan)||(a.push(e.kelurahan),t+=`<option value="${e.kelurahan}">${e.kelurahan}</option>`))}),$("select[name=kelurahan]").html(t)):$("select[name=kelurahan]").attr("disabled",!0),$("select[name=kelurahan]").val("")});const filterNasabah=async a=>{let t=new FormData(a.parentElement.parentElement.parentElement),e=`${t.get("orderby")} - `;nasabahUrl=`${APIURL}/admin/getnasabah?orderby=${t.get("orderby")}`,t.get("kelurahan")&&(e+=`${t.get("kelurahan")}, `,nasabahUrl+=`&kelurahan=${t.get("kelurahan")}`),t.get("kecamatan")&&(e+=`${t.get("kecamatan")}, `,nasabahUrl+=`&kecamatan=${t.get("kecamatan")}`),t.get("kota")&&(e+=`${t.get("kota")}, `,nasabahUrl+=`&kota=${t.get("kota")}`),t.get("provinsi")&&(e+=`${t.get("provinsi")}`,nasabahUrl+=`&provinsi=${t.get("provinsi")}`),""==t.get("provinsi")&&(e=`${t.get("orderby")} - semua wilayah`,nasabahUrl=`${APIURL}/admin/getnasabah?orderby=${t.get("orderby")}`),$("#ket-filter").html(e),getAllNasabah()},resetFilterNasabah=async a=>{$("select[name=orderby]").val("terbaru"),$("select[name=provinsi]").val(""),$("select[name=kota]").val(""),$("select[name=kota]").attr("disabled",!0),$("select[name=kecamatan]").val(""),$("select[name=kecamatan]").attr("disabled",!0),$("select[name=kelurahan]").val(""),$("select[name=kelurahan]").attr("disabled",!0)};let arrayNasabah=[],nasabahUrl=`${APIURL}/admin/getnasabah?orderby=terbaru`;const getAllNasabah=async()=>{$("#search-nasabah").val(""),$("#ket-total").html("0"),$("#table-nasabah tbody").html(""),$("#list-nasabah-notfound").addClass("d-none"),$("#list-nasabah-spinner").removeClass("d-none");let a=await httpRequestGet(nasabahUrl);if($("#list-nasabah-spinner").addClass("d-none"),404===a.status)$("#list-nasabah-notfound").removeClass("d-none"),$("#list-nasabah-notfound #text-notfound").html("belum ada nasabah");else if(200===a.status){let t="",e=a.data.data;arrayNasabah=a.data.data,e.forEach((a,e)=>{let s="belum login";if(a.last_active!=a.created_at){let t=new Date(1e3*parseInt(a.last_active)),e=t.toLocaleString("en-US",{hour:"numeric",minute:"numeric"}),d=t.toLocaleString("en-US",{day:"numeric"}),i=t.toLocaleString("en-US",{month:"long"}),n=t.toLocaleString("en-US",{year:"numeric"});s=`${d}-${i}-${n} ${e}`}t+=`<tr class="text-xs">\n            <td class="align-middle text-center py-3">\n                <span class="font-weight-bold"> ${++e} </span>\n            </td>\n            <td class="align-middle text-center py-3">\n                <span class="font-weight-bold"> ${a.id} </span>\n            </td>\n            <td class="align-middle text-center">\n                <span class="font-weight-bold text-capitalize"> ${a.nama_lengkap} </span>\n            </td>\n            <td class="align-middle text-center">\n                <span class="font-weight-bold badge border ${"t"===a.is_verify||"1"===a.is_verify?"text-success border-success":"text-warning border-warning"} pb-1" style="border-radius:4px;">\n                    ${"t"===a.is_verify||"1"===a.is_verify?"yes":"no"}\n                </span>\n            </td>\n            <td class="align-middle text-center">\n                <span class="font-weight-bold text-capitalize"> \n                    ${s}\n                </span>\n            </td>\n            <td class="align-middle text-center">\n                <div clas="row w-100">\n                    <div class="col-12 px-0">\n                        <a href='' id="btn-hapus" class="badge badge-danger text-xxs pb-1 rounded-sm cursor-pointer w-100" onclick="hapusNasabah('${a.id}',event)" style="border-radius:4px;">hapus</a>\n                    </div>\n                    <div class="col-12 px-0 mt-2">\n                        <a href='' id="btn-hapus" class="badge badge-warning text-xxs pb-1 rounded-sm cursor-pointer w-100" data-toggle="modal" data-target="#modalAddEditNasabah" onclick="openModalAddEditNsb('editasabah','${a.id}')" style="border-radius:4px;">edit</a>\n                    </div>\n                    <div class="col-12 px-0 mt-2">\n                        <a href="${BASEURL}/admin/detilnasabah/${a.id}" id="btn-detil" class="badge badge-info text-xxs pb-1 rounded-sm cursor-pointer w-100" style="border-radius:4px;" target="_blank">detil</a>\n                    </div>\n                </div>\n            </td>\n        </tr>`}),$("#ket-total").html(arrayNasabah.length),$("#table-nasabah tbody").html(t)}};getAllNasabah(),$("#search-nasabah").on("keyup",function(){let a="",t=[];t=""===$(this).val()?arrayNasabah:arrayNasabah.filter(a=>a.nama_lengkap.includes($(this).val().toLowerCase())||a.id.includes($(this).val())),0==t.length?($("#list-nasabah-notfound").removeClass("d-none"),$("#list-nasabah-notfound #text-notfound").html("nasabah tidak ditemukan")):($("#list-nasabah-notfound").addClass("d-none"),$("#list-nasabah-notfound #text-notfound").html(" "),t.forEach((t,e)=>{let s="belum login";if(t.last_active!=t.created_at){let a=new Date(1e3*parseInt(t.last_active)),e=a.toLocaleString("en-US",{hour:"numeric",minute:"numeric"}),d=a.toLocaleString("en-US",{day:"numeric"}),i=a.toLocaleString("en-US",{month:"long"}),n=a.toLocaleString("en-US",{year:"numeric"});s=`${d}-${i}-${n} ${e}`}a+=`<tr class="text-xs">\n                <td class="align-middle text-center py-3">\n                    <span class="font-weight-bold"> ${++e} </span>\n                </td>\n                <td class="align-middle text-center py-3">\n                    <span class="font-weight-bold"> ${t.id} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold text-capitalize"> ${t.nama_lengkap} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold badge border ${"t"===t.is_verify||"1"===t.is_verify?"text-success border-success":"text-warning border-warning"} pb-1" style="border-radius:4px;">\n                        ${"t"===t.is_verify||"1"===t.is_verify?"yes":"no"}\n                    </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold text-capitalize"> \n                        ${s}\n                    </span>\n                </td>\n                <td class="align-middle text-center">\n                    <div clas="row w-100">\n                        <div class="col-12 px-0">\n                            <a href='' id="btn-hapus" class="badge badge-danger text-xxs pb-1 rounded-sm cursor-pointer w-100" onclick="hapusNasabah('${t.id}',event)" style="border-radius:4px;">hapus</a>\n                        </div>\n                        <div class="col-12 px-0 mt-2">\n                            <a href='' id="btn-hapus" class="badge badge-warning text-xxs pb-1 rounded-sm cursor-pointer w-100" data-toggle="modal" data-target="#modalAddEditNasabah" onclick="openModalAddEditNsb('editasabah','${t.id}')" style="border-radius:4px;">edit</a>\n                        </div>\n                        <div class="col-12 px-0 mt-2">\n                            <a href="${BASEURL}/admin/detilnasabah/${t.id}" id="btn-detil" class="badge badge-info text-xxs pb-1 rounded-sm cursor-pointer w-100" style="border-radius:4px;" target="_blank">detil</a>\n                        </div>\n                    </div>\n                </td>\n            </tr>`})),$("#ket-total").html(t.length),$("#table-nasabah tbody").html(a)});const openModalAddEditNsb=(a,t=null)=>{let e="addnasabah"==a?"tambah nasabah":"edit nasabah";$("#modalAddEditNasabah .modal-title").html(e),$("#formAddEditNasabah .form-check-input").prop("checked",!1),$("#formAddEditNasabah .form-control").removeClass("is-invalid"),$("#formAddEditNasabah .form-check-input").removeClass("is-invalid"),$("#formAddEditNasabah .text-danger").html(""),"addnasabah"==a?($("#modalAddEditNasabah .addnasabah-item").removeClass("d-none"),$("#modalAddEditNasabah .editnasabah-item").addClass("d-none"),$("#formAddEditNasabah .form-control").val("")):($("#modalAddEditNasabah .addnasabah-item").addClass("d-none"),$("#modalAddEditNasabah .editnasabah-item").removeClass("d-none"),$("#modalAddEditNasabah #list-nasabah-spinner").removeClass("d-none"),getProfileNasabah(t))},searchKodepos=async a=>{$("#kodepos-wraper").html(`<div class="position-absolute bg-white d-flex align-items-center justify-content-center" style="z-index: 10;top: 0;bottom: 0;left: 0;right: 0;">\n       <img src="${BASEURL}/assets/images/spinner.svg" style="width: 20px;" />\n    </div>`),axios.get(`https://kodepos.vercel.app/search/?q=${a.value}`,{headers:{}}).then(a=>{if(200===a.data.code)if("No data can be returned."===a.data.messages)$("#kodepos-wraper").html('<div class="position-absolute bg-white d-flex align-items-center justify-content-center" style="z-index: 10;top: 0;bottom: 0;left: 0;right: 0;">\n                    <h6 style="opacity: 0.6;">kodepos tidak ditemukan</h6>\n                </div>');else{let t="";a.data.data.forEach(a=>{t+=`\n                    <div class="w-100">\n                        <div class="kodepos-list w-100 d-flex align-items-center px-3 py-3" style="cursor: pointer;font-size:16px;" onclick="changeKodeposVal(this,'${a.postalcode}','${a.urban}','${a.subdistrict}','${a.city}','${a.province}');">\n                            <span class="w-100" style="display: -webkit-box;-webkit-line-clamp: 1;-webkit-box-orient: vertical;overflow: hidden;text-overflow: ellipsis;">\n                                ${a.postalcode} - ${a.urban}, ${a.subdistrict}, ${a.city}, ${a.province}\n                            </span>\n                        </div>\n                    </div>`}),$("#kodepos-wraper").html(t)}})},changeKodeposVal=(a,t,e,s,d,i)=>{$(".kodepos-list").removeClass("active"),$("input[name=kodepos]").val(t),$("input[name=kelurahan]").val(e),$("input[name=kecamatan]").val(s),$("input[name=kota]").val(d),$("input[name=provinsi]").val(i),a.classList.add("active")},crudNasabah=async(a,t)=>{t.preventDefault();let e=new FormData(a);if(doValidate(e)){let a="",t=$("#modalAddEditNasabah .modal-title").html();if(""!=e.get("tgl_lahir")){let a=e.get("tgl_lahir").split("-");e.set("tgl_lahir",`${a[2]}-${a[1]}-${a[0]}`)}$("#formAddEditNasabah button#submit #text").addClass("d-none"),$("#formAddEditNasabah button#submit #spinner").removeClass("d-none"),"edit nasabah"==t?(e.set("is_verify",$("#formAddEditNasabah input[name=is_verify]").val()),a=await httpRequestPut(`${APIURL}/admin/editnasabah`,e)):(e.set("kodepos",$("input[name=kodepos]").val()),a=await httpRequestPost(`${APIURL}/register/nasabah`,e)),$("#formAddEditNasabah button#submit #text").removeClass("d-none"),$("#formAddEditNasabah button#submit #spinner").addClass("d-none"),201===a.status?(getAllWilayah(),getAllNasabah(),"tambah nasabah"==t&&($("#formAddEditNasabah .form-control").val(""),$("#kodepos-wraper").html('<div class="position-absolute bg-white d-flex align-items-center justify-content-center" style="z-index: 10;top: 0;bottom: 0;left: 0;right: 0;">\n                    <h6 style="opacity: 0.6;">kodepos tidak ditemukan</h6>\n                </div>')),showAlert({message:`<strong>Success...</strong> nasabah berhasil ${"tambah nasabah"==t?"ditambah":"diedit"}!`,autohide:!0,type:"success"})):400===a.status&&(showAlert({message:"<strong>Gagal...</strong> cek kembali kolom input nasabah",autohide:!0,type:"warning"}),a.message.email&&($("#formAddEditNasabah #email").addClass("is-invalid"),$("#formAddEditNasabah #email-error").text(a.message.email)),a.message.username&&($("#formAddEditNasabah #username").addClass("is-invalid"),$("#formAddEditNasabah #username-error").text(a.message.username)),a.message.tgl_lahir&&($("#formAddEditNasabah #tgllahir").addClass("is-invalid"),$("#formAddEditNasabah #tgllahir-error").text(a.message.tgl_lahir)),a.message.notelp&&($("#formAddEditNasabah #notelp").addClass("is-invalid"),$("#formAddEditNasabah #notelp-error").text(a.message.notelp)),a.message.nik&&($("#formAddEditNasabah #nik").addClass("is-invalid"),$("#formAddEditNasabah #nik-error").text(a.message.nik)))}},getProfileNasabah=async a=>{let t=await httpRequestGet(`${APIURL}/admin/getnasabah?id=${a}`);if($("#modalAddEditNasabah #list-nasabah-spinner").addClass("d-none"),200===t.status){dataNasabah=t.data.data[0];for(const a in dataNasabah)$(`#formAddEditNasabah input[name=${a}]`).val(dataNasabah[a]);if("00-00-0000"!=dataNasabah.tgl_lahir.split("-")){let a=dataNasabah.tgl_lahir.split("-");$("#formAddEditNasabah input[name=tgl_lahir]").val(`${a[2]}-${a[1]}-${a[0]}`)}$(`#formAddEditNasabah input#kelamin-${dataNasabah.kelamin}`).prop("checked",!0),"t"==dataNasabah.is_verify||"1"===dataNasabah.is_verify?($("#formAddEditNasabah input[name=is_verify]").val("1"),$("#formAddEditNasabah .toggle-akunverify").removeClass("bg-secondary").addClass("active bg-success")):($("#formAddEditNasabah input[name=is_verify]").val("0"),$("#formAddEditNasabah .toggle-akunverify").removeClass("active bg-success").addClass("bg-secondary")),$("#newpass").val("")}};$("#formAddEditNasabah .form-check-input").on("click",function(a){$("#formAddEditNasabah input[name=kelamin]").val($(this).val()),$("#formAddEditNasabah .form-check-input").prop("checked",!1),$(this).prop("checked",!0)}),$("#formAddEditNasabah input[type=checkbox]").on("click",function(a){"1"==$(this).val()?($(this).val("0"),$(this).parent().removeClass("active bg-success").addClass("bg-secondary")):($(this).val("1"),$(this).parent().removeClass("bg-secondary").addClass("active bg-success"))});const doValidate=a=>{let t=!0,e=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;$(".form-control").removeClass("is-invalid"),$(".form-check-input").removeClass("is-invalid"),$(".text-danger").html(""),""==$("#formAddEditNasabah #nama").val()?($("#formAddEditNasabah #nama").addClass("is-invalid"),$("#formAddEditNasabah #nama-error").html("*nama lengkap harus di isi"),t=!1):$("#formAddEditNasabah #nama").val().length>40&&($("#formAddEditNasabah #nama").addClass("is-invalid"),$("#formAddEditNasabah #nama-error").html("*maksimal 40 huruf"),t=!1),""==$("#formAddEditNasabah input[name=kelamin]").val()&&($(".form-check-input").addClass("is-invalid"),t=!1),$("#modalAddEditNasabah .addnasabah-item").hasClass("d-none")?(""==$("#formAddEditNasabah #email").val()||e.test(String($("#formAddEditNasabah #email").val()).toLowerCase())||($("#formAddEditNasabah #email").addClass("is-invalid"),$("#formAddEditNasabah #email-error").html("*email tidak valid"),t=!1),""==$("#formAddEditNasabah #username").val()?($("#formAddEditNasabah #username").addClass("is-invalid"),$("#formAddEditNasabah #username-error").html("*username harus di isi"),t=!1):$("#formAddEditNasabah #username").val().length<8||$("#formAddEditNasabah #username").val().length>20?($("#formAddEditNasabah #username").addClass("is-invalid"),$("#formAddEditNasabah #username-error").html("*minimal 8 huruf dan maksimal 20 huruf"),t=!1):/\s/.test($("#formAddEditNasabah #username").val())&&($("#formAddEditNasabah #username").addClass("is-invalid"),$("#formAddEditNasabah #username-error").html("*tidak boleh ada spasi"),t=!1),""!==$("#modalAddEditNasabah #newpass").val()&&($("#modalAddEditNasabah #newpass").val().length<8||$("#modalAddEditNasabah #newpass").val().length>20?($("#modalAddEditNasabah #newpass").addClass("is-invalid"),$("#modalAddEditNasabah #newpass-error").html("*minimal 8 huruf dan maksimal 20 huruf"),t=!1):/\s/.test($("#modalAddEditNasabah #newpass").val())&&($("#modalAddEditNasabah #newpass").addClass("is-invalid"),$("#modalAddEditNasabah #newpass-error").html("*tidak boleh ada spasi"),t=!1))):(""==$("#formAddEditNasabah #rt").val()?($("#formAddEditNasabah #rt").addClass("is-invalid"),$("#formAddEditNasabah #rt-error").html("*rt harus di isi"),t=!1):$("#formAddEditNasabah #rt").val().length<3||$("#formAddEditNasabah #rt").val().length>3?($("#formAddEditNasabah #rt").addClass("is-invalid"),$("#formAddEditNasabah #rt-error").html("*minimal 2 huruf dan maksimal 2 huruf"),t=!1):/^\d+$/.test($("#formAddEditNasabah #rt").val())||($("#formAddEditNasabah #rt").addClass("is-invalid"),$("#formAddEditNasabah #rt-error").html("*hanya boleh angka"),t=!1),""==$("#formAddEditNasabah #rw").val()?($("#formAddEditNasabah #rw").addClass("is-invalid"),$("#formAddEditNasabah #rw-error").html("*rw harus di isi"),t=!1):$("#formAddEditNasabah #rw").val().length<3||$("#formAddEditNasabah #rw").val().length>3?($("#formAddEditNasabah #rw").addClass("is-invalid"),$("#formAddEditNasabah #rw-error").html("*minimal 2 huruf dan maksimal 2 huruf"),t=!1):/^\d+$/.test($("#formAddEditNasabah #rw").val())||($("#formAddEditNasabah #rw").addClass("is-invalid"),$("#formAddEditNasabah #rw-error").html("*hanya boleh angka"),t=!1),""==$("#formAddEditNasabah #kodepos").val()?($("#formAddEditNasabah #kodepos").addClass("is-invalid"),$("#formAddEditNasabah #kodepos-error").html("*kodepos harus di isi"),t=!1):$("#formAddEditNasabah #kodepos").val().length<5||$("#formAddEditNasabah #kodepos").val().length>5?($("#formAddEditNasabah #kodepos").addClass("is-invalid"),$("#formAddEditNasabah #kodepos-error").html("*minimal 5 huruf dan maksimal 5 huruf"),t=!1):/^\d+$/.test($("#formAddEditNasabah #kodepos").val())||($("#formAddEditNasabah #kodepos").addClass("is-invalid"),$("#formAddEditNasabah #kodepos-error").html("*hanya boleh angka"),t=!1));let s="";return""!=$("#formAddEditNasabah #nik").val()&&nikParse($("#formAddEditNasabah #nik").val(),function(a){s=a}),"error"==s.status&&($("#formAddEditNasabah #nik").addClass("is-invalid"),$("#formAddEditNasabah #nik-error").html(s.pesan),t=!1),$("#formAddEditNasabah #notelp").val().length>14?($("#formAddEditNasabah #notelp").addClass("is-invalid"),$("#formAddEditNasabah #notelp-error").html("*maksimal 14 huruf"),t=!1):""==$("#formAddEditNasabah #notelp").val()||/^\d+$/.test($("#formAddEditNasabah #notelp").val())||($("#formAddEditNasabah #notelp").addClass("is-invalid"),$("#formAddEditNasabah #notelp-error").html("*hanya boleh angka"),t=!1),$("#formAddEditNasabah #alamat").val().length>255&&($("#formAddEditNasabah #alamat").addClass("is-invalid"),$("#formAddEditNasabah #alamat-error").html("*maksimal 255 huruf"),t=!1),t},hapusNasabah=(a,t)=>{t.preventDefault(),Swal.fire({input:"password",inputAttributes:{autocapitalize:"off"},html:"<h5 class='mb-4'>Password</h5>",showCancelButton:!0,confirmButtonText:"submit",showLoaderOnConfirm:!0,preConfirm:t=>{let e=new FormData;return e.append("hashedpass",PASSADMIN),e.append("password",t),axios.post(`${APIURL}/admin/confirmdelete`,e,{headers:{}}).then(t=>httpRequestDelete(`${APIURL}/admin/deletenasabah?id=${a}`).then(a=>{201==a.status?(getAllWilayah(),getAllNasabah()):400==a.status&&showAlert({message:`<strong>Gagal . . .</strong> ${a.message}`,autohide:!0,type:"danger"})})).catch(a=>{404==a.response.status?Swal.showValidationMessage("password salah"):500==a.response.status&&Swal.showValidationMessage("terjadi kesalahan, coba sekali lagi")})},allowOutsideClick:()=>!Swal.isLoading()})};