function getCurrentDate(){let a=new Date((new Date).getTime()),t=a.toLocaleString("en-US",{day:"2-digit"}),e=a.toLocaleString("en-US",{month:"2-digit"}),s=a.toLocaleString("en-US",{year:"numeric"});return`${s}-${e}-${t}`}function getCurrentTime(){let a=new Date((new Date).getTime());return a.toLocaleString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})}const clearAllForm=(a=!1)=>{$("#formWraper .form-check-input").removeClass("is-invalid"),$("#formWraper .form-control").removeClass("is-invalid"),$("#formWraper .form-check-input").prop("checked",!1),$("#formWraper .text-danger").html(""),$("#formWraper .form-control").val(""),$("#form-tarik-saldo #maximal-saldo span").html(""),a&&($(".barisSetorSampah").remove(),tambahBaris(),countTotalHarga())};let idnasabah="",formTarget="setor-jual-sampah";$("#toggle-transaksi-wraper .switch-section").on("click",function(a){$(".toggle-transaksi").removeClass(`bg-${$(".toggle-transaksi").attr("data-color")}`),$(".toggle-transaksi").attr("data-color",$(this).data("color")),$(".toggle-transaksi").addClass(`bg-${$(this).data("color")}`),$("#toggle-transaksi-wraper .switch-section").removeClass("opacity-0"),$(this).addClass("opacity-0"),$(".toggle-transaksi").css("transform",`translateX(${$(this).position().left}px)`),$(".toggle-transaksi").html($(this).html()),idnasabah="",formTarget=$(this).data("form"),$("#barrier-transaksi").removeClass("d-none"),$("#formWraper form").addClass("d-none opacity-6"),$(`#form-${formTarget}`).removeClass("d-none"),$("#search-nasabah-wraper table td span").html(""),"setor sampah"==$(this).html()||"jual sampah"==$(this).html()?clearAllForm(!0):clearAllForm(),$("#pemilik-saldo-wraper").removeClass("d-none"),$("#pemilik-saldo").val("nasabah"),$("#form-tarik-saldo #input-jenis-saldo").removeClass("d-none"),$("#form-tarik-saldo #input-jenis-emas").removeClass("d-none"),jenisForm=$(this).html(),"jual sampah"==jenisForm?($("#pemilik-saldo-wraper").addClass("d-none"),$("#barrier-transaksi").addClass("d-none"),$(`#form-${formTarget}`).removeClass("opacity-6"),$("#search-nasabah-wraper").addClass("d-none"),$(`#form-${formTarget} input[type=date]`).val(getCurrentDate()),$(`#form-${formTarget} input[type=time]`).val(getCurrentTime())):("tarik saldo"!=jenisForm&&$("#pemilik-saldo-wraper").addClass("d-none"),$("#search-nasabah-wraper").removeClass("d-none"),$("#barrier-search-nasabah").addClass("d-none"),$("#search-nasabah-wraper .input-group").removeClass("opacity-6"))});const getSaldoBsbl=async()=>{let a=await httpRequestGet(`${APIURL}/transaksi/getsaldo`);if(200===a.status){let t=a.data.data;$("#form-tarik-saldo #maximal-saldo-bsbl span").html(`Rp ${modifUang(t.saldo_bank)}`)}};getSaldoBsbl(),$("#pemilik-saldo").on("click",function(a){"bsbl"==$(this).val()?($("#barrier-transaksi").addClass("d-none"),$("#form-tarik-saldo").removeClass("opacity-6"),$("#form-tarik-saldo").attr("data-pemilik","bsbl"),$("#search-nasabah-wraper").addClass("d-none"),$("#barrier-search-nasabah").removeClass("d-none"),$("#search-nasabah-wraper .input-group").addClass("opacity-6"),$("#form-tarik-saldo input[type=date]").val(getCurrentDate()),$("#form-tarik-saldo input[type=time]").val(getCurrentTime()),$("#form-tarik-saldo #input-jenis-saldo").addClass("d-none"),$("#form-tarik-saldo #input-jenis-emas").addClass("d-none"),$("#form-tarik-saldo #maximal-saldo").addClass("d-none"),$("#form-tarik-saldo #maximal-saldo-bsbl").removeClass("d-none"),$("#form-tarik-saldo .keterangan").removeClass("d-none")):($("#barrier-transaksi").removeClass("d-none"),$("#form-tarik-saldo").addClass("opacity-6"),$("#form-tarik-saldo").attr("data-pemilik","nasabah"),$("#search-nasabah-wraper").removeClass("d-none"),$("#barrier-search-nasabah").addClass("d-none"),$("#search-nasabah-wraper .input-group").removeClass("opacity-6"),$("#form-tarik-saldo #input-jenis-saldo").removeClass("d-none"),$("#form-tarik-saldo #input-jenis-emas").removeClass("d-none"),$("#form-tarik-saldo #maximal-saldo").removeClass("d-none"),$("#form-tarik-saldo #maximal-saldo-bsbl").addClass("d-none"),$("#form-tarik-saldo .keterangan").addClass("d-none"))});let dataNasabah="",dataSaldo="";const searchNasabah=async(a=!1,t=!1)=>{if(!1!==t&&t.preventDefault(),""==$("#search-nasabah").val())return 0;$("#btn-search-nasabah #text").addClass("d-none"),$("#btn-search-nasabah #spinner").removeClass("d-none");let e=$("#search-nasabah").val(),s=await httpRequestGet(`${APIURL}/admin/getnasabah?key=${e}`);if($("#btn-search-nasabah #text").removeClass("d-none"),$("#btn-search-nasabah #spinner").addClass("d-none"),200===s.status){dataNasabah=s.data.data[0],idnasabah=dataNasabah.id,$("#btn-search-nasabah #text").addClass("d-none"),$("#btn-search-nasabah #spinner").removeClass("d-none");let a=await httpRequestGet(`${APIURL}/transaksi/getsaldo?idnasabah=${idnasabah}`);dataSaldo=a.data.data,$("#btn-search-nasabah #text").removeClass("d-none"),$("#btn-search-nasabah #spinner").addClass("d-none"),$("#id-check").html(idnasabah),$("#email-check").html(dataNasabah.email),$("#username-check").html(dataNasabah.username),$("#nama-lengkap-check").html(dataNasabah.nama_lengkap),$("#saldo-uang-check").html(`Rp. ${modifUang(dataSaldo.uang)}`),$("#saldo-emas-check").html(`${parseFloat(dataSaldo.emas||0).toFixed(4)} g`),$("#barrier-transaksi").addClass("d-none"),$(`#form-${formTarget}`).removeClass("opacity-6"),$(`#form-${formTarget} input[type=date]`).val(getCurrentDate()),$(`#form-${formTarget} input[type=time]`).val(getCurrentTime())}else 404===s.status&&(showAlert({message:"<strong>Ups...</strong> nasabah tidak ditemukan!",autohide:!0,type:"warning"}),$("#id-check").html(""),$("#email-check").html(""),$("#username-check").html(""),$("#nama-lengkap-check").html(""),$("#saldo-uang-check").html(""),$("#saldo-emas-check").html(""),$("#barrier-transaksi").removeClass("d-none"),$(`#form-${formTarget}`).addClass("opacity-6"))};let arrayJenisSampah=[];const getAllJenisSampah=async()=>{let a=await httpRequestGet(`${APIURL}/sampah/getsampah`);200===a.status&&(arrayJenisSampah=a.data.data),$(".barisSetorSampah").remove(),tambahBaris(),countTotalHarga()};getAllJenisSampah();let jenisForm="";const tambahBaris=(a=!1)=>{a&&a.preventDefault();let t=[],e='<option data-kategori="" selected>-- kategori sampah  --</option>';0!==arrayJenisSampah.length&&arrayJenisSampah.forEach(a=>{t.includes(a.kategori)||(t.push(a.kategori),e+=`<option data-kategori="${a.kategori}">${a.kategori}</option>`)});let s=$(".barisSetorSampah").size(),n=` <td class="py-2" style="border-right: 0.5px solid #E9ECEF;">\n        <span class="w-100 btn btn-danger d-flex justify-content-center align-items-center border-radius-sm" style="height: 38px;margin: 0;" onclick="hapusBaris(this);">\n            <i class="fas fa-times text-white"></i>\n        </span>\n    </td>\n    <td class="py-2" style="border-right: 0.5px solid #E9ECEF;">\n        <span class="nomor w-100 d-flex justify-content-center align-items-center border-radius-sm" style="height: 38px;margin: 0;">\n            ${$(".barisSetorSampah").size()+1}\n        </span>\n    </td>\n    <td class="py-2" style="border-right: 0.5px solid #E9ECEF;">\n        <select id="kategori-berita-wraper" class="inputJenisSampah form-control form-control-sm py-1 pl-2 border-radius-sm" style="min-height: 38px" onchange="insertJenisSampah(this,event);">\n            ${e}\n        </select>\n    </td>\n    <td class="py-2" style="border-right: 0.5px solid #E9ECEF;">\n        <select id="kategori-berita-wraper" class="inputJenisSampah form-control form-control-sm py-1 pl-2 border-radius-sm" name="transaksi[slot${s+1}][id_sampah]" style="min-height: 38px" onchange="getHargaInOption(this,event);" disabled>\n            <option>-- jenis sampah  --</option>\n        </select>\n    </td>\n    <td class="py-2" style="border-right: 0.5px solid #E9ECEF;">\n        <input type="text" class="inputJumlahSampah form-control form-control-sm pl-2 border-radius-sm" value="0" name="transaksi[slot${s+1}][jumlah]" style="min-height: 38px" onkeyup="countHargaXjumlah(this);" autocomplete="off">\n        <small class="text-danger"></small>\n    </td>\n    <td class="py-2">\n        <input type="text" class="inputHargaSampah form-control form-control-sm pl-2 border-radius-sm" style="min-height: 38px" data-harga="0" value="0" disabled>\n    </td>`,r=document.createElement("tr");r.classList.add("barisSetorSampah"),r.innerHTML=n,document.querySelector("#table-setor-sampah tbody").insertBefore(r,document.querySelector("#special-tr"))},hapusBaris=a=>{a.parentElement.parentElement.remove(),$(".barisSetorSampah").each(function(a,t){t.querySelector(".nomor").innerHTML=a+1}),countTotalHarga()},insertJenisSampah=(a,t)=>{var e=t.target.options[t.target.selectedIndex].dataset.kategori;let s="<option value='' data-harga='' data-harga_pusat='' data-tersedia=\"0\" selected>-- jenis sampah --</option>",n=arrayJenisSampah.sort((a,t)=>a.jenis.localeCompare(t.jenis));n.forEach(a=>{a.kategori==e&&(s+=`<option value='${a.id}' data-harga='${a.harga}'  data-harga_pusat='${a.harga_pusat}' data-tersedia="${a.jumlah}">${a.jenis}</option>`)});let r=a.parentElement.nextElementSibling.children[0],i=a.parentElement.nextElementSibling.nextElementSibling.children[0],l=a.parentElement.nextElementSibling.nextElementSibling.nextElementSibling.children[0];r.innerHTML=s,i.value=0,l.value=0,l.setAttribute("data-harga",0),countTotalHarga(),""!=e?r.removeAttribute("disabled"):r.setAttribute("disabled",!0)},getHargaInOption=(a,t)=>{var e="";e="jual sampah"==jenisForm?t.target.options[t.target.selectedIndex].dataset.harga_pusat:t.target.options[t.target.selectedIndex].dataset.harga;var s=t.target.options[t.target.selectedIndex].dataset.tersedia;let n=a.parentElement.nextElementSibling.children[0];n.value=1,n.setAttribute("data-tersedia",s),n.classList.remove("is-invalid"),n.nextElementSibling.innerHTML="";let r=a.parentElement.nextElementSibling.nextElementSibling.children[0];r.value=e,r.setAttribute("data-harga",e),countTotalHarga()},countHargaXjumlah=a=>{var t=a.value;let e=a.parentElement.previousElementSibling.children[0];if(""!==e.value&&""!==t){let e=a.parentElement.nextElementSibling.children[0],s=e.getAttribute("data-harga");e.value=parseFloat(parseFloat(t)*parseInt(s)).toFixed(2),countTotalHarga()}},countTotalHarga=()=>{let a=0;$(".inputHargaSampah").each(function(){a+=parseFloat($(this).val())}),$("#special-tr #total-harga").html(modifUang(a.toString()))},validateSetorJualSampah=()=>{let a=!0,t="";return $("#form-setor-jual-sampah .form-control").removeClass("is-invalid"),$("#form-setor-jual-sampah .text-danger").html(""),""==$("#form-setor-jual-sampah #date").val()&&($("#form-setor-jual-sampah #date").addClass("is-invalid"),$("#form-setor-jual-sampah #date-error").html("*waktu harus di isi"),a=!1),""==$("#form-setor-jual-sampah #time").val()&&($("#form-setor-jual-sampah #time").addClass("is-invalid"),$("#form-setor-jual-sampah #date-error").html("*waktu harus di isi"),a=!1),$(".inputJenisSampah").each(function(){(""==$(this).val()||$(this).attr("disabled"))&&($(this).addClass("is-invalid"),a=!1,t="input tidak boleh kosong!")}),$(".inputJumlahSampah").each(function(){""==$(this).val()&&($(this).addClass("is-invalid"),a=!1,t="input tidak boleh kosong!"),/[^0-9\.]/g.test($(this).val().replace(/ /g,""))&&($(this).addClass("is-invalid"),a=!1,t="jumlah hanya boleh berupa angka positif dan titik!")}),0==a&&""!==t&&showAlert({message:`<strong>${t}</strong>`,autohide:!0,type:"danger"}),a},validatePindahSaldo=()=>{let a=!0;new FormData(document.querySelector("#form-konversi-saldo"));return $("#form-konversi-saldo .form-check-input").removeClass("is-invalid"),$("#form-konversi-saldo .form-control").removeClass("is-invalid"),$("#form-konversi-saldo .text-danger").html(""),""==$("#form-konversi-saldo #date").val()&&($("#form-konversi-saldo #date").addClass("is-invalid"),$("#form-konversi-saldo #date-error").html("*tanggal harus di isi"),a=!1),""==$("#form-konversi-saldo #time").val()&&($("#form-konversi-saldo #time").addClass("is-invalid"),$("#form-konversi-saldo #date-error").html("*waktu harus di isi"),a=!1),""==$("#form-konversi-saldo #harga_emas").val()?($("#form-konversi-saldo #harga_emas").addClass("is-invalid"),$("#form-konversi-saldo #harga_emas-error").html("*harga emas harus di isi"),a=!1):/[^0-9\.]/g.test($("#form-konversi-saldo #harga_emas").val().replace(/ /g,""))&&($("#form-konversi-saldo #harga_emas").addClass("is-invalid"),$("#form-konversi-saldo #harga_emas-error").html("*hanya boleh berupa angka positif dan titik!"),a=!1),""==$("#form-konversi-saldo #jumlah").val()?($("#form-konversi-saldo #jumlah").addClass("is-invalid"),$("#form-konversi-saldo #jumlah-error").html("*jumlah saldo harus di isi"),a=!1):/[^0-9\.]/g.test($("#form-konversi-saldo #jumlah").val().replace(/ /g,""))?($("#form-konversi-saldo #jumlah").addClass("is-invalid"),$("#form-konversi-saldo #jumlah-error").html("*hanya boleh berupa angka positif dan titik!"),a=!1):parseFloat($("#form-konversi-saldo #jumlah").val())<1e4&&($("#form-konversi-saldo #jumlah").addClass("is-invalid"),$("#form-konversi-saldo #jumlah-error").html("*minimal Rp.10,000"),a=!1),a};$("#form-tarik-saldo input[name=jenis_saldo]").on("click",function(){"uang"==$(this).attr("value")?($("#form-tarik-saldo #maximal-saldo span").html(`Rp ${modifUang(dataSaldo.uang)}`),$("#form-tarik-saldo #jenis-emas").attr("disabled",!0),$("#form-tarik-saldo #jenis-emas").val("")):($("#form-tarik-saldo #maximal-saldo span").html(`${dataSaldo.emas} g`),$("#form-tarik-saldo #jenis-emas").removeAttr("disabled"))});const validateTarikSaldo=a=>{let t=!0,e=new FormData(document.querySelector("#form-tarik-saldo"));return $("#form-tarik-saldo .form-check-input").removeClass("is-invalid"),$("#form-tarik-saldo .form-control").removeClass("is-invalid"),$("#form-tarik-saldo .text-danger").html(""),""==$("#form-tarik-saldo #date").val()&&($("#form-tarik-saldo #date").addClass("is-invalid"),$("#form-tarik-saldo #date-error").html("*tanggal harus di isi"),t=!1),""==$("#form-tarik-saldo #time").val()&&($("#form-tarik-saldo #time").addClass("is-invalid"),$("#form-tarik-saldo #date-error").html("*waktu harus di isi"),t=!1),"bsbl"!=a&&(null==e.get("jenis_saldo")&&($("#form-tarik-saldo .form-check-input").addClass("is-invalid"),t=!1),"emas"==e.get("jenis_saldo")&&""==e.get("jenis_emas")&&($("#form-tarik-saldo #jenis-emas").addClass("is-invalid"),t=!1)),""==$("#form-tarik-saldo #jumlah").val()?($("#form-tarik-saldo #jumlah").addClass("is-invalid"),$("#form-tarik-saldo #jumlah-error").html("*jumlah saldo harus di isi"),t=!1):/[^0-9\.]/g.test($("#form-tarik-saldo #jumlah").val().replace(/ /g,""))&&($("#form-tarik-saldo #jumlah").addClass("is-invalid"),$("#form-tarik-saldo #jumlah-error").html("*hanya boleh berupa angka positif dan titik!"),t=!1),"bsbl"==a&&""==$("#form-tarik-saldo #description").val()&&($("#form-tarik-saldo #description").addClass("is-invalid"),$("#form-tarik-saldo #description-error").html("*keterangan harus di isi"),t=!1),t},validateTarikSaldoBsbl=()=>{let a=!0;new FormData(document.querySelector("#form-tarik-saldo"));return $("#form-tarik-saldo .form-check-input").removeClass("is-invalid"),$("#form-tarik-saldo .form-control").removeClass("is-invalid"),$("#form-tarik-saldo .text-danger").html(""),""==$("#form-tarik-saldo #date").val()&&($("#form-tarik-saldo #date").addClass("is-invalid"),$("#form-tarik-saldo #date-error").html("*tanggal harus di isi"),a=!1),""==$("#form-tarik-saldo #time").val()&&($("#form-tarik-saldo #time").addClass("is-invalid"),$("#form-tarik-saldo #date-error").html("*waktu harus di isi"),a=!1),""==$("#form-tarik-saldo #jumlah").val()?($("#form-tarik-saldo #jumlah").addClass("is-invalid"),$("#form-tarik-saldo #jumlah-error").html("*jumlah saldo harus di isi"),a=!1):/[^0-9\.]/g.test($("#form-tarik-saldo #jumlah").val().replace(/ /g,""))&&($("#form-tarik-saldo #jumlah").addClass("is-invalid"),$("#form-tarik-saldo #jumlah-error").html("*hanya boleh berupa angka positif dan titik!"),a=!1),a},doTransaksi=async(a,t,e)=>{t.preventDefault();let s="",n=a.parentElement.parentElement,r="",i=n.getAttribute("data-pemilik");"pindahsaldo"==e?(s=validatePindahSaldo,r="pindah saldo"):"tariksaldo"==e?(s=validateTarikSaldo,r="tarik saldo",console.log(i),"bsbl"==i&&(e="tariksaldobsbl")):"setorjualsampah"==e&&(s=validateSetorJualSampah,""==idnasabah?(e="jualsampah",r="jual sampah"):(e="setorsampah",r="setor sampah"));let l=async()=>{let a=new FormData(n),t=a.get("date").split("-"),s=a.get("time");a.set("date",`${t[2]}-${t[1]}-${t[0]} ${s}`),""==idnasabah?a.set("id_admin",IDADMIN):a.set("id_nasabah",idnasabah),"tariksaldo"==e&&""!==$("#form-tarik-saldo #jenis-emas").val()&&a.set("jenis_saldo",$("#form-tarik-saldo #jenis-emas").val()),showLoadingSpinner(),httpResponse=await httpRequestPost(`${APIURL}/transaksi/${e}`,a),hideLoadingSpinner(),201===httpResponse.status?(clearAllForm(),getAllJenisSampah(),updateAllTable(`${t[0]}/${t[1]}/31`),"jualsampah"!=e?($("#search-nasabah-wraper table td span").html("_ _ _ _"),$(`#form-${formTarget}`).addClass("opacity-6"),$("#barrier-transaksi").removeClass("d-none"),searchNasabah()):(getSaldoBsbl(),$(`#form-${formTarget} input[type=date]`).val(getCurrentDate()),$(`#form-${formTarget} input[type=time]`).val(getCurrentTime())),"tariksaldo"!=e&&"tariksaldobsbl"!=e||($("#form-tarik-saldo #maximal-saldo span").html(""),$("#form-tarik-saldo #jenis-emas").attr("disabled",!0),$("#form-tarik-saldo #jenis-emas").val(""),"bsbl"==i&&(getSaldoBsbl(),$(`#form-${formTarget}`).removeClass("opacity-6"),$("#barrier-transaksi").addClass("d-none"),$(`#form-${formTarget} input[type=date]`).val(getCurrentDate()),$(`#form-${formTarget} input[type=time]`).val(getCurrentTime()))),showAlert({message:`<strong>Success...</strong> ${r} berhasil!`,autohide:!0,type:"success"})):400===httpResponse.status&&httpResponse.message.jumlah&&("pindahsaldo"==e?($("#form-konversi-saldo #jumlah").addClass("is-invalid"),$("#form-konversi-saldo #jumlah-error").html(`*${httpResponse.message.jumlah}`)):($("#form-tarik-saldo #jumlah").addClass("is-invalid"),$("#form-tarik-saldo #jumlah-error").html(`*${httpResponse.message.jumlah}`)))};s(i)&&l()},updateAllTable=a=>{let t=new Date(`${a} 00:00:01`).getTime();setCurrentStartDate(t),getDataTransaksi(),ketFilter=`${new Date(t).getFullYear()} - semua wilayah`,rekapTUrl=`${APIURL}/transaksi/rekapdata?year=${new Date(t).getFullYear()}`,$("#ket-filter-rekap-transaksi").html(ketFilter),getRekapTransaksi()},deleteTransaksi=(a,t)=>{t.preventDefault(),Swal.fire({title:"ANDA YAKIN?",text:"Data akan terhapus permanen",icon:"warning",showCancelButton:!0,confirmButtonText:"iya"}).then(t=>{t.isConfirmed&&Swal.fire({input:"password",inputAttributes:{autocapitalize:"off"},html:"<h5 class='mb-4'>Password</h5>",showCancelButton:!0,confirmButtonText:"submit",showLoaderOnConfirm:!0,preConfirm:t=>{let e=new FormData;return e.append("hashedpass",PASSADMIN),e.append("password",t),axios.post(`${APIURL}/admin/confirmdelete`,e,{headers:{}}).then(t=>httpRequestDelete(`${APIURL}/transaksi/deletedata?id=${a}`).then(a=>{201==a.status&&(getAllJenisSampah(),getDataTransaksi(),getSaldoBsbl())})).catch(a=>{404==a.response.status?Swal.showValidationMessage("password salah"):500==a.response.status&&Swal.showValidationMessage("terjadi kesalahan, coba sekali lagi")})},allowOutsideClick:()=>!Swal.isLoading()})})};let dateStar="",dateEnd="",ketDateStar="",ketDateEnd="",orderby="terbaru",jenisTransaksi="semua jenis",openModalFilterDataT=()=>{let a=$("#ket-filter-data-transaksi #startdate").html().split("/"),t=$("#ket-filter-data-transaksi #enddate").html().split("/");$("#formFilterDataTransaksi input[name=date-start]").val(`${a[2]}-${a[1]}-${a[0]}`),$("#formFilterDataTransaksi input[name=date-end]").val(`${t[2]}-${t[1]}-${t[0]}`)};$("#formFilterDataTransaksi input[type=date]").on("change",function(a){let t=$("#formFilterDataTransaksi input[name=date-start]").val(),e=$("#formFilterDataTransaksi input[name=date-end]").val();t&&e?($("#btn-filter-data-transaksi").attr("data-dismiss","modal"),$("#btn-filter-data-transaksi").attr("onclick","filterDataTransaksi(this,event);"),$("#formFilterDataTransaksi input[type=date]").removeClass("is-invalid")):($("#btn-filter-data-transaksi").removeAttr("data-dismiss"),$("#btn-filter-data-transaksi").removeAttr("onclick"),""==t&&$("#formFilterDataTransaksi input[name=date-start]").addClass("is-invalid"),""==e&&$("#formFilterDataTransaksi input[name=date-end]").addClass("is-invalid"))});let setCurrentStartDate=(a=null)=>{let t="";t=a?new Date(a):new Date((new Date).getTime());let e=t.toLocaleString("en-US",{day:"2-digit"}),s=t.toLocaleString("en-US",{month:"2-digit"}),n=t.toLocaleString("en-US",{year:"numeric"}),r=new Date(t.getTime()-2592e6),i=r.toLocaleString("en-US",{day:"2-digit"}),l=r.toLocaleString("en-US",{month:"2-digit"}),o=r.toLocaleString("en-US",{year:"numeric"});dateStar=`${i}-${l}-${o}`,dateEnd=`${e}-${s}-${n}`,ketDateStar=`${i}/${l}/${o}`,ketDateEnd=`${e}/${s}/${n}`,$("#ket-filter-data-transaksi").html(`\n    <span id='startdate'>${ketDateStar}</span> \n    <i class="fas fa-long-arrow-alt-right mt-1 mx-2"></i> \n    <span id='enddate'>${ketDateEnd}</span> \n    &nbsp;&nbsp;(${orderby} - ${jenisTransaksi})`)};setCurrentStartDate();const filterDataTransaksi=a=>{let t=new FormData(a.parentElement.parentElement.parentElement),e=t.get("date-start").split("-");dateStar=`${e[2]}-${e[1]}-${e[0]}`,ketDateStar=`${e[2]}/${e[1]}/${e[0]}`;let s=t.get("date-end").split("-");dateEnd=`${s[2]}-${s[1]}-${s[0]}`,ketDateEnd=`${s[2]}/${s[1]}/${s[0]}`,orderby=t.get("orderby"),jenisTransaksi=t.get("jenis_transaksi"),$("#ket-filter-data-transaksi").html(`\n    <span id='startdate'>${ketDateStar}</span> \n    <i class="fas fa-long-arrow-alt-right text-secondary mt-1 mx-2"></i> \n    <span id='enddate'>${ketDateEnd}</span> \n    &nbsp;&nbsp;(${orderby} - ${jenisTransaksi})`),getDataTransaksi()};let arrayDataTransaksi=[];const getDataTransaksi=async()=>{$("#search-data-transaksi").val(""),$("#ket-total").html("0"),$("#table-data-transaksi tbody").html(""),$("#data-transaksi-notfound").addClass("d-none"),$("#data-transaksi-spinner").removeClass("d-none");let a=await httpRequestGet(`${APIURL}/transaksi/getdata?start=${dateStar}&end=${dateEnd}&orderby=${orderby}`);if($("#data-transaksi-spinner").addClass("d-none"),404===a.status)$("#data-transaksi-notfound").removeClass("d-none"),$("#data-transaksi-notfound").html("<h6 class='opacity-6'>belum ada transaksi</h6>");else if(200===a.status){let t="",e="";e="semua jenis"==jenisTransaksi?a.data.data:a.data.data.filter(a=>a.jenis_transaksi==jenisTransaksi),arrayDataTransaksi=e,e.forEach(a=>{let e=new Date(1e3*parseInt(a.date)),s=e.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit"}),n=e.toLocaleString("en-US",{day:"2-digit"}),r=e.toLocaleString("en-US",{month:"long"}),i=e.toLocaleString("en-US",{year:"numeric"}),l="",o="";"penyetoran sampah"==a.jenis_transaksi?(l="success",o=`+ ${parseFloat(a.total_kg_setor).toFixed(2)} kg`):"penarikan saldo"==a.jenis_transaksi?(l="danger",o="uang"==a.jenis_saldo?`- Rp ${modifUang(parseFloat(a.total_tarik).toFixed(0))}`:`- ${parseFloat(a.total_tarik).toFixed(4)} g`):"konversi saldo"==a.jenis_transaksi?(l="warning",o="Rp"+modifUang(kFormatter(a.total_pindah))+' <i class="fas fa-exchange-alt"></i> '+parseFloat(a.hasil_konversi).toFixed(2)+"g"):(l="info",o=`- ${parseFloat(a.total_kg_jual).toFixed(2)} kg`);let d="penjualan sampah"==a.jenis_transaksi?"span":"a";t+=`<tr>\n                <td class="align-middle text-sm py-4">\n                    <span class="text-xs text-name font-weight-bold"> \n                        ${a.id_transaksi}\n                    </span>\n                </td>\n                <td class="align-middle text-sm" style="max-width: 120px;white-space: nowrap;">\n                    <${d} href="${BASEURL}/admin/detilnasabah/${a.id_user}" target="_blank" class="text-xs text-name font-weight-bold text-dark opacity-8" style="white-space: normal;word-break: break-all;display: block;">\n                        <u>${a.nama_lengkap}</u>\n                    </${d}>\n                </td>\n                <td class="align-middle text-sm">\n                    <span class="text-xxs text-name font-weight-bold badge border bg-${l} text-white border-${l} pb-1" style="min-width:150px;max-width:150px;border-radius:4px;letter-spacing:0.5px;"> \n                        ${a.jenis_transaksi}\n                    </span>\n                </td>\n                <td class="align-middle text-sm">\n                    <span class="text-xs text-name font-weight-bold"> \n                        ${o}\n                    </span>\n                </td>\n                <td class="align-middle text-sm">\n                    <span class="text-xs text-name font-weight-bold">\n                        ${n}-${r}-${i} ${s}\n                    </span>\n                </td>\n                <td class="align-middle text-center">\n                    <a href='' class="badge badge-dark text-xxs pb-1 cursor-pointer" data-toggle="modal" data-target="#modalPrintTransaksi" onclick="getDetailTransaksi('${a.id_transaksi}');" style="border-radius:4px;">cetak</a>\n                    <a href='' class="badge badge-danger text-xxs pb-1 cursor-pointer" onclick="deleteTransaksi('${a.id_transaksi}',event);" style="border-radius:4px;">hapus</a>\n                </td>\n            </tr>`}),$("#ket-total").html(e.length),$("#table-data-transaksi tbody").html(t)}};getDataTransaksi(),$("#search-data-transaksi").on("keyup",function(){let a="",t=[];t=""===$(this).val()?arrayDataTransaksi:arrayDataTransaksi.filter(a=>a.nama_lengkap.toLowerCase().includes($(this).val().toLowerCase())||a.id_transaksi.toLowerCase().includes($(this).val().toLowerCase())),0==t.length?($("#data-transaksi-notfound").removeClass("d-none"),$("#data-transaksi-notfound #text-notfound").html("transaksi tidak ditemukan")):($("#data-transaksi-notfound").addClass("d-none"),$("#data-transaksi-notfound #text-notfound").html(" "),t.forEach(t=>{let e=new Date(1e3*parseInt(t.date)),s=e.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit"}),n=e.toLocaleString("en-US",{day:"2-digit"}),r=e.toLocaleString("en-US",{month:"long"}),i=e.toLocaleString("en-US",{year:"numeric"}),l="",o="";"penyetoran sampah"==t.jenis_transaksi?(l="success",o=`+ ${parseFloat(t.total_kg_setor).toFixed(2)} kg`):"penarikan saldo"==t.jenis_transaksi?(l="danger",o="uang"==t.jenis_saldo?`- Rp ${modifUang(parseFloat(t.total_tarik).toFixed(0))}`:`- ${parseFloat(t.total_tarik).toFixed(4)} g`):"konversi saldo"==t.jenis_transaksi?(l="warning",o="Rp"+modifUang(kFormatter(t.total_pindah))+' <i class="fas fa-exchange-alt"></i> '+parseFloat(t.hasil_konversi).toFixed(2)+"g"):(l="info",o=`- ${parseFloat(t.total_kg_jual).toFixed(2)} kg`);let d="penjualan sampah"==t.jenis_transaksi?"span":"a";a+=`<tr>\n                <td class="align-middle text-sm py-4">\n                    <span class="text-xs text-name font-weight-bold"> \n                        ${t.id_transaksi}\n                    </span>\n                </td>\n                <td class="align-middle text-sm" style="max-width: 120px;white-space: nowrap;">\n                    <${d} href="${BASEURL}/admin/detilnasabah/${t.id_user}" target="_blank" class="text-xs text-name font-weight-bold text-dark opacity-8" style="white-space: normal;word-break: break-all;display: block;">\n                        <u>${t.nama_lengkap}</u>\n                    </${d}>\n                </td>\n                <td class="align-middle text-sm">\n                    <span class="text-xxs text-name font-weight-bold badge border bg-${l} text-white border-${l} pb-1" style="min-width:150px;max-width:150px;border-radius:4px;letter-spacing:0.5px;"> \n                        ${t.jenis_transaksi}\n                    </span>\n                </td>\n                <td class="align-middle text-sm">\n                    <span class="text-xs text-name font-weight-bold"> \n                        ${o}\n                    </span>\n                </td>\n                <td class="align-middle text-sm">\n                    <span class="text-xs text-name font-weight-bold">\n                        ${n}-${r}-${i} ${s}\n                    </span>\n                </td>\n                <td class="align-middle text-center">\n                    <a href='' class="badge badge-dark text-xxs pb-1 cursor-pointer" data-toggle="modal" data-target="#modalPrintTransaksi" onclick="getDetailTransaksi('${t.id_transaksi}');" style="border-radius:4px;">cetak</a>\n                    <a href='' class="badge badge-danger text-xxs pb-1 cursor-pointer" onclick="deleteTransaksi('${t.id_transaksi}',event);" style="border-radius:4px;">hapus</a>\n                </td>\n            </tr>`})),$("#ket-total").html(t.length),$("#table-data-transaksi tbody").html(a)});const getDetailTransaksi=async a=>{$("#detil-transaksi-body").html(" "),$("#detil-transaksi-spinner").removeClass("d-none");let t=await httpRequestGet(`${APIURL}/transaksi/getdata?id_transaksi=${a}`);if(200===t.status){$("#detil-transaksi-spinner").addClass("d-none");let a=new Date(1e3*parseInt(t.data.data.date)),e=a.toLocaleString("en-US",{day:"numeric"}),s=a.toLocaleString("en-US",{month:"numeric"}),n=a.toLocaleString("en-US",{year:"numeric"}),r=a.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"});if($("#detil-transaksi-date").html(`${e}/${s}/${n}&nbsp;&nbsp;&nbsp;${r}`),$("#detil-transaksi-nama").html(t.data.data.nama_lengkap),$("#detil-transaksi-idnasabah").html(t.data.data.id_user),$("#detil-transaksi-idtransaksi").html(t.data.data.id_transaksi),$("#detil-transaksi-type").html(t.data.data.jenis_transaksi),$("#btn-cetak-transaksi").attr("href",`${BASEURL}/transaksi/cetaktransaksi/${t.data.data.id_transaksi}`),"penjualan sampah"==t.data.data.jenis_transaksi?($("#modalPrintTransaksiTarget td#id-user").html("ID.ADMIN"),$("#modalPrintTransaksi .modal-dialog").addClass("modal-lg")):($("#modalPrintTransaksiTarget td#id-user").html("ID.NASABAH"),$("#modalPrintTransaksi .modal-dialog").removeClass("modal-lg")),"penarikan saldo"==t.data.data.jenis_transaksi){let a=t.data.data.jenis_saldo,e="uang"==a?"Rp "+modifUang(parseFloat(t.data.data.jumlah_tarik).toFixed(0)):parseFloat(t.data.data.jumlah_tarik).toFixed(4)+" gram",s=t.data.data.description;$("#detil-transaksi-body").html(`<div class="p-4 bg-secondary border-radius-sm">\n                <table>\n                    <tr class="text-dark">\n                        <td><h4>Jenis saldo&nbsp;</h4></td>\n                        <td>\n                            <h4>\n                            : &nbsp;&nbsp;${"uang"==a?a:"emas "+a}\n                            </h4>\n                        </td>\n                    </tr>\n                    <tr class="text-dark">\n                        <td><h4>Jumlah</h4></td>\n                        <td><h4>: &nbsp;&nbsp;${e}</h4></td>\n                    </tr>\n                </table>\n                <div class="${null==s?"d-none":""}">\n                    <hr class="horizontal dark mt-2">\n                    <div class="text-dark text-center">\n                        "<i>${s}</i>"\n                    </div>\n                </div>\n            </div>`)}
if("konversi saldo"==t.data.data.jenis_transaksi&&$("#detil-transaksi-body").html(`<div class="p-4 bg-secondary border-radius-sm">\n            <table>\n                <tr class="text-dark">\n                    <td>Jumlah</td>\n                    <td>: &nbsp;&nbsp;Rp ${modifUang(t.data.data.jumlah)}</td>\n                </tr>\n                <tr class="text-dark">\n                    <td>Harga emas</td>\n                    <td>: &nbsp;&nbsp;Rp ${modifUang(t.data.data.harga_emas)}</td>\n                </tr>\n                <tr class="text-dark">\n                    <td>Hasil konversi&nbsp;</td>\n                    <td>\n                        : &nbsp;&nbsp;${parseFloat(t.data.data.hasil_konversi).toFixed(4)} g\n                    </td>\n                </tr>\n            </table>\n            </div>`),["penyetoran sampah"].includes(t.data.data.jenis_transaksi)){let a=0,e=0,s="",n=t.data.data.barang;n.forEach((t,n)=>{a+=parseFloat(t.jumlah_rp),e+=parseFloat(t.jumlah_kg),s+=`<tr class="text-center">\n                    <th scope="row">${++n}</th>\n                    <td>${t.jenis}</td>\n                    <td>${parseFloat(t.jumlah_kg).toFixed(2)} kg</td>\n                    <td class="text-right">${modifUang(t.jumlah_rp)}</td>\n                </tr>`}),$("#detil-transaksi-body").html(`<table class="table table-striped">\n                <thead>\n                    <tr>\n                        <th scope="col">#</th>\n                        <th scope="col">Jenis sampah</th>\n                        <th scope="col">Jumlah</th>\n                        <th scope="col">Harga</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${s}\n                    <tr>\n                        <th class="text-center" colspan='2'>Total</th>\n                        <td class="text-center">${parseFloat(e).toFixed(2)}</td>\n                        <td class="text-center">${modifUang(a.toString())}</td>\n                    </tr>\n                </tbody>\n            </table>`)}if("penjualan sampah"==t.data.data.jenis_transaksi){let a=0,e=0,s=0,n=0,r="",i=t.data.data.barang;i.forEach((t,i)=>{a+=t.jumlah_kg,e+=parseFloat(t.jumlah_rp),s+=parseFloat(t.harga_nasabah);let l=parseFloat(t.jumlah_rp).toFixed(2)-parseFloat(t.harga_nasabah).toFixed(2);n+=parseFloat(l).toFixed(2),r+=`<tr class="text-center">\n                    <td>${t.jenis}</td>\n                    <td class="text-right">${parseFloat(t.jumlah_kg).toFixed(2)} kg</td>\n                    <td class="text-right">${modifUang(t.jumlah_rp)}</td>\n                    <td class="text-right">${modifUang(t.harga_nasabah)}</td>\n                    <td class="text-right">${modifUang(parseFloat(l).toFixed(2))}</td>\n                </tr>`}),$("#detil-transaksi-body").html(`<table class="table table-striped">\n                <thead>\n                    <tr>\n                        <th scope="col">Jenis sampah</th>\n                        <th scope="col">Jumlah</th>\n                        <th scope="col">Harga Jual</th>\n                        <th scope="col">Harga Beli</th>\n                        <th scope="col">Selisih</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${r}\n                    <tr>\n                        <th class="text-center">Total</th>\n                        <td class="text-right">${parseFloat(a).toFixed(2)} kg</td>\n                        <td class="text-right">Rp ${modifUang(parseFloat(e).toFixed(2))}</td>\n                        <td class="text-right">Rp ${modifUang(parseFloat(s).toFixed(2))}</td>\n                        <td class="text-right">Rp ${modifUang(parseFloat(n).toFixed(2))}</td>\n                    </tr>\n                </tbody>\n            </table>`)}}};let openModalFilterRekapT=()=>{let a=$("#ket-filter-rekap-transaksi").html().split("-");a[1].includes("semua wilayah")&&resetFilterRekap(null,a[0].replace(" ",""))},formTargetRekap="pertahun";$("#toggle-rekap-wraper .switch-section").on("click",function(a){if($(".toggle-rekap").removeClass(`bg-${$(".toggle-rekap").attr("data-color")}`),$(".toggle-rekap").attr("data-color",$(this).data("color")),$(".toggle-rekap").addClass(`bg-${$(this).data("color")}`),$("#toggle-rekap-wraper .switch-section").removeClass("opacity-0"),$(this).addClass("opacity-0"),$(".toggle-rekap").css("transform",`translateX(${$(this).position().left}px)`),$(".toggle-rekap").html($(this).html()),formTargetRekap=$(this).data("form"),$("#modalFilterRekapTransaksi form").addClass("d-none"),$(`#formFilterRekap-${formTargetRekap}`).removeClass("d-none"),$("#modalFilterRekapTransaksi .modal-footer").addClass("d-none"),$(`#modal-footer-${formTargetRekap}`).removeClass("d-none"),"custom"==formTargetRekap){let a=new Date((new Date).getTime()),t=a.toLocaleString("en-US",{day:"2-digit"}),e=a.toLocaleString("en-US",{month:"2-digit"}),s=a.toLocaleString("en-US",{year:"numeric"}),n=new Date(a.getTime()-2592e6),r=n.toLocaleString("en-US",{day:"2-digit"}),i=n.toLocaleString("en-US",{month:"2-digit"}),l=n.toLocaleString("en-US",{year:"numeric"});$("#formFilterRekap-custom input[name=date-start]").val(`${l}-${i}-${r}`),$("#formFilterRekap-custom input[name=date-end]").val(`${s}-${e}-${t}`),$("#formFilterRekap-custom input[type=date]").removeClass("is-invalid"),$("#btn-filter-rekap-custom").attr("onclick","cetakCustomRekap();")}resetFilterRekap(),insertPorvinsi()});let arrayWilayah=[];const getAllWilayah=async()=>{let a=await httpRequestGet(`${APIURL}/nasabah/wilayah`);200===a.status&&(arrayWilayah=a.data.data,insertPorvinsi())};getAllWilayah();const insertPorvinsi=()=>{let a=[],t='<option value="">-- pilih provinsi --</option>';arrayWilayah.forEach(e=>{a.includes(e.provinsi)||(a.push(e.provinsi),t+=`<option value="${e.provinsi}" data-provinsi="${e.provinsi}">${e.provinsi}</option>`)}),$("#modalFilterRekapTransaksi select[name=provinsi]").html(t)};$("#modalFilterRekapTransaksi select[name=provinsi]").on("change",function(){let a=[],t='<option value="">-- pilih kota --</option>';""!=$(this).val()?($("#modalFilterRekapTransaksi select[name=kota]").removeAttr("disabled"),arrayWilayah.forEach(e=>{e.provinsi==$(this).val()&&(a.includes(e.kota)||(a.push(e.kota),t+=`<option value="${e.kota}">${e.kota}</option>`))}),$("#modalFilterRekapTransaksi select[name=kota]").html(t)):$("#modalFilterRekapTransaksi select[name=kota]").attr("disabled",!0),$("#modalFilterRekapTransaksi select[name=kota]").val(""),$("#modalFilterRekapTransaksi select[name=kecamatan]").val(""),$("#modalFilterRekapTransaksi select[name=kecamatan]").attr("disabled",!0),$("#modalFilterRekapTransaksi select[name=kelurahan]").val(""),$("#modalFilterRekapTransaksi select[name=kelurahan]").attr("disabled",!0)}),$("#modalFilterRekapTransaksi select[name=kota]").on("change",function(){let a=[],t='<option value="">-- pilih kecamatan --</option>';""!=$(this).val()?($("#modalFilterRekapTransaksi select[name=kecamatan]").removeAttr("disabled"),arrayWilayah.forEach(e=>{e.kota==$(this).val()&&(a.includes(e.kecamatan)||(a.push(e.kecamatan),t+=`<option value="${e.kecamatan}">${e.kecamatan}</option>`))}),$("#modalFilterRekapTransaksi select[name=kecamatan]").html(t)):$("#modalFilterRekapTransaksi select[name=kecamatan]").attr("disabled",!0),$("#modalFilterRekapTransaksi select[name=kecamatan]").val(""),$("#modalFilterRekapTransaksi select[name=kelurahan]").val(""),$("#modalFilterRekapTransaksi select[name=kelurahan]").attr("disabled",!0)}),$("#modalFilterRekapTransaksi select[name=kecamatan]").on("change",function(){let a=[],t='<option value="">-- pilih kelurahan --</option>';""!=$(this).val()?($("#modalFilterRekapTransaksi select[name=kelurahan]").removeAttr("disabled"),arrayWilayah.forEach(e=>{e.kecamatan==$(this).val()&&(a.includes(e.kelurahan)||(a.push(e.kelurahan),t+=`<option value="${e.kelurahan}">${e.kelurahan}</option>`))}),$("#modalFilterRekapTransaksi select[name=kelurahan]").html(t)):$("#modalFilterRekapTransaksi select[name=kelurahan]").attr("disabled",!0),$("#modalFilterRekapTransaksi select[name=kelurahan]").val("")}),$("#formFilterRekap-custom input[type=date]").on("change",function(a){let t=$("#formFilterRekap-custom input[name=date-start]").val(),e=$("#formFilterRekap-custom input[name=date-end]").val();t&&e?($("#formFilterRekap-custom input[type=date]").removeClass("is-invalid"),$("#btn-filter-rekap-custom").attr("onclick","cetakCustomRekap();")):($("#btn-filter-rekap-custom").removeAttr("onclick"),""==t&&$("#formFilterRekap-custom input[name=date-start]").addClass("is-invalid"),""==e&&$("#formFilterRekap-custom input[name=date-end]").addClass("is-invalid"))});const doFilterRekapPertahun=async()=>{let a=new FormData(document.querySelector("#formFilterRekap-pertahun")),t=`${a.get("year")} - `;rekapTUrl=`${APIURL}/transaksi/rekapdata?year=${a.get("year")}`,wilayahRekapUrl="",a.get("kelurahan")&&(t+=`${a.get("kelurahan")}, `,rekapTUrl+=`&kelurahan=${a.get("kelurahan")}`,wilayahRekapUrl+=`kelurahan=${a.get("kelurahan")}&`),a.get("kecamatan")&&(t+=`${a.get("kecamatan")}, `,rekapTUrl+=`&kecamatan=${a.get("kecamatan")}`,wilayahRekapUrl+=`kecamatan=${a.get("kecamatan")}&`),a.get("kota")&&(t+=`${a.get("kota")}, `,rekapTUrl+=`&kota=${a.get("kota")}`,wilayahRekapUrl+=`kota=${a.get("kota")}&`),a.get("provinsi")&&(t+=`${a.get("provinsi")}`,rekapTUrl+=`&provinsi=${a.get("provinsi")}`,wilayahRekapUrl+=`provinsi=${a.get("provinsi")}`),""==a.get("provinsi")&&(t=`${a.get("year")} - semua wilayah`,rekapTUrl=`${APIURL}/transaksi/rekapdata?year=${a.get("year")}`,wilayahRekapUrl=""),$("#ket-filter-rekap-transaksi").html(t),getRekapTransaksi()},cetakCustomRekap=()=>{let a=new FormData(document.querySelector("#formFilterRekap-custom")),t=a.get("date-start").split("-"),e=a.get("date-end").split("-"),s=a.get("jenis"),n=`${t[2]}-${t[1]}-${t[0]}`,r=`${e[2]}-${e[1]}-${e[0]}`,i="&wilayah=false",l=`${BASEURL}/transaksi/cetakrekap/${s}?start=${n}&end=${r}`;a.get("kelurahan")&&(i="&wilayah=true",l+=`&kelurahan=${a.get("kelurahan")}`),a.get("kecamatan")&&(i="&wilayah=true",l+=`&kecamatan=${a.get("kecamatan")}`),a.get("kota")&&(i="&wilayah=true",l+=`&kota=${a.get("kota")}`),a.get("provinsi")&&(i="&wilayah=true",l+=`&provinsi=${a.get("provinsi")}`),window.open(l+i,"_blank")},resetFilterRekap=(a=null,t=null)=>{a&&a.preventDefault(a),t?$("#modalFilterRekapTransaksi select[name=year]").val(t):$("#modalFilterRekapTransaksi select[name=year]").val((new Date).getFullYear()),$("#modalFilterRekapTransaksi select[name=orderby]").val("terbaru"),$("#modalFilterRekapTransaksi select[name=provinsi]").val(""),$("#modalFilterRekapTransaksi select[name=kota]").val(""),$("#modalFilterRekapTransaksi select[name=kota]").attr("disabled",!0),$("#modalFilterRekapTransaksi select[name=kecamatan]").val(""),$("#modalFilterRekapTransaksi select[name=kecamatan]").attr("disabled",!0),$("#modalFilterRekapTransaksi select[name=kelurahan]").val(""),$("#modalFilterRekapTransaksi select[name=kelurahan]").attr("disabled",!0)};let rekapTUrl=`${APIURL}/transaksi/rekapdata?year=${(new Date).getFullYear()}`,wilayahRekapUrl="";const getRekapTransaksi=async()=>{$("#table-rekap-transaksi tbody").html(""),$("#rekap-transaksi-spinner").removeClass("d-none"),$("#rekap-transaksi-notfound").addClass("d-none");let a=await httpRequestGet(rekapTUrl);if($("#rekap-transaksi-spinner").addClass("d-none"),404===a.status)$("#rekap-transaksi-notfound").removeClass("d-none"),$("#rekap-transaksi-notfound").html("<h6 class='opacity-6'>belum ada transaksi</h6>");else if(200===a.status){let t=0,e="",s=a.data.data;for(const a in s)e+=`<tr>\n                <td class="align-middle text-sm text-center" style="border-right: 0.5px solid rgba(222, 226, 230, 0.6);">\n                    <span class="text-xs font-weight-bold">\n                        ${++t}\n                    </span>\n                </td>\n                <td class="align-middle text-center">\n                    <a href="" target="_blank" class="badge badge-dark text-xxs pb-1 cursor-pointer" style="border-radius:4px;"  data-toggle="modal" data-target="#modalJenisLaporan" onclick="openModalJenisLaporan('${s[a].date1}');">\n                        cetak\n                    </a>\n                </td>\n                <td class="align-middle text-sm text-center" style="border-right: 0.5px solid rgba(222, 226, 230, 0.6);">\n                    <span class="text-xs text-name font-weight-bold">\n                        ${s[a].date2}\n                    </span>\n                </td>\n                <td class="py-3 align-middle text-sm text-center" style="border-right: 0.5px solid rgba(222, 226, 230, 0.6);">\n                    <span class="text-xs text-name font-weight-bold">\n                        <i class="fas fa-trash text-xs text-success mr-1"></i>\n                        <span class="text-success">\n                            ${parseFloat(s[a].totSampahMasuk).toFixed(2)} kg\n                        </span>\n                    </span>\n                </td>\n                <td class="py-3 align-middle text-sm text-center" style="border-right: 0.5px solid rgba(222, 226, 230, 0.6);">\n                    <span class="${""!=wilayahRekapUrl?"d-none":""} text-xs text-name font-weight-bold">\n                        <i class="fas fa-trash text-xs text-info mr-1"></i>\n                        <span class="text-info">\n                            ${parseFloat(s[a].totSampahKeluar).toFixed(2)} kg\n                        </span>\n                    </span>\n                </td>\n                <td class="align-middle text-sm text-center" style="border-right: 0.5px solid rgba(222, 226, 230, 0.6);">\n                    <span class="text-xs text-name font-weight-bold text-success">\n                        Rp ${kFormatter(s[a].totUangMasuk)}\n                    </span>\n                </td>\n                <td class="align-middle text-sm text-center" style="border-right: 0.5px solid rgba(222, 226, 230, 0.6);">\n                    <span class="text-xs text-name font-weight-bold text-danger">\n                        Rp ${kFormatter(s[a].totUangKeluar)}\n                    </span>\n                </td>\n                <td class="align-middle text-sm text-center" style="border-right: 0.5px solid rgba(222, 226, 230, 0.6);letter-spacing:0.5px;color:orange;">\n                    <span class="text-xs text-name font-weight-bold">\n                        <i class="fas fa-coins text-xs mr-1"></i>\n                        ${parseFloat(s[a].totEmasMasuk).toFixed(2)}  g\n                    </span>\n                </td>\n                <td class="align-middle text-sm text-center" style="border-right: 0.5px solid rgba(222, 226, 230, 0.6);">\n                    <span class="text-xs text-name font-weight-bold text-danger">\n                        <i class="fas fa-coins text-xs mr-1"></i>\n                        ${parseFloat(s[a].totEmasKeluar).toFixed(2)} g\n                    </span>\n                </td>\n            </tr>`;$("#table-rekap-transaksi tbody").html(e)}};getRekapTransaksi();const openModalJenisLaporan=a=>{document.querySelector("#formJenisLaporan input[name=date]").value=a};document.querySelector("#formJenisLaporan").addEventListener("submit",function(a){a.preventDefault();let t=new FormData(a.target),e=t.get("date"),s=t.get("jenis");if($("#formJenisLaporan input[name=jenis]").removeClass("is-invalid"),""==s)return showAlert({message:"<strong>Warning!!</strong> pilih jenis laporan !!",autohide:!0,type:"warning"}),0;window.open(`${BASEURL}/transaksi/cetakrekap/${s}?date=${e}&wilayah=${""!=wilayahRekapUrl?"true":""}&${wilayahRekapUrl}`,"_blank")});