function saveTemporaryContent(){let e={published_at:$("#formCrudArticle #published_at").val(),title:$("#formCrudArticle #title").val(),kategori:$("#formCrudArticle #kategori-artikel-wraper").val(),content:$(".ql-editor").html()};localStorage.setItem("add-artikel",JSON.stringify(e))}function editTemporaryContent(){"tambah artikel"===pageTitle2&&dataTemporaryContent&&(dataTemporaryContent.published_at&&$("#formCrudArticle #published_at").val(dataTemporaryContent.published_at),dataTemporaryContent.title&&$("#formCrudArticle #title").val(dataTemporaryContent.title),dataTemporaryContent.kategori&&$("#formCrudArticle #kategori-artikel-wraper").val(dataTemporaryContent.kategori),$(".ql-editor").html(dataTemporaryContent.content))}function validateCrudArtikel(){let e=!0;return $(".form-control").removeClass("is-invalid"),$(".text-danger").html(""),""==IDARTIKEL&&""==$("#thumbnail").val()&&($("#thumbnail").addClass("is-invalid"),e=!1),""==$("#published_at").val()&&($("#published_at").addClass("is-invalid"),e=!1),""==$("#title").val()?($("#title").addClass("is-invalid"),e=!1):$("#title").val().length>250&&($("#title").addClass("is-invalid"),$("#title-error").html("*maximal 250 character"),e=!1),""==$("#kategori-artikel-wraper").val()&&($("#kategori-artikel-wraper").addClass("is-invalid"),e=!1),e}if("tambah artikel"===pageTitle2||"edit artikel"===pageTitle2){Quill.register("modules/imageCompressor",imageCompressor);var quill=new Quill("#editor-container",{modules:{imageResize:{displaySize:!0,debug:!1},imageCompressor:{quality:.9,imageType:"image/jpeg",debug:!1},formula:!0,syntax:!0,toolbar:"#toolbar-container"},theme:"snow"})}const getAllKatArtikel=async()=>{showLoadingSpinner();let e="<option value='' selected>-- pilih kategori --</option>",t=await httpRequestGet(`${APIURL}/artikel/getkategori`);200===t.status?(t.data.data.forEach((t,a)=>{e+=`<option id="${t.id}" value="${t.id}">${t.name}</option>`}),"edit artikel"===pageTitle2?getDetailBerita():hideLoadingSpinner()):hideLoadingSpinner(),$("#kategori-artikel-wraper").html(e),editTemporaryContent()};getAllKatArtikel();const getDetailBerita=async()=>{let e=await httpRequestGet(`${APIURL}/artikel/getartikel?id=${IDARTIKEL}`);if(hideLoadingSpinner(),404==e.status&&Swal.fire({icon:"error",title:"<strong>NOT FOUND</strong>",text:`artikel dengan id '${IDARTIKEL}' tidak ditemukan!`,showCancelButton:!1,confirmButtonText:"ok"}).then(()=>{window.location.replace(`${BASEURL}/admin/listartikel`)}),200===e.status){let t=e.data.data,a=new Date(1e3*parseInt(t.published_at)),i=a.toLocaleString("en-US",{day:"2-digit"}),r=a.toLocaleString("en-US",{month:"2-digit"}),l=a.toLocaleString("en-US",{year:"numeric"});$("#idartikel").val(t.id),document.querySelector("#preview-thumbnail").src=t.thumbnail,$("#published_at").val(`${l}-${r}-${i}`),$("#title").val(t.title),$("#kategori-artikel-wraper").val(t.id_kategori),$(".ql-editor").html(t.content)}};$("#formCrudArticle").on("submit",async e=>{if(e.preventDefault(),validateCrudArtikel()){let t="",a=new FormData(e.target),i=a.get("published_at").split("-");""!==fileThumbnail&&a.set("thumbnail",fileThumbnail,fileThumbnail.name),a.append("content",$(".ql-editor").html()),a.set("published_at",`${i[2]}-${i[1]}-${i[0]}`),showLoadingSpinner(),""!==IDARTIKEL?(""!==fileThumbnail&&a.set("new_thumbnail",fileThumbnail,fileThumbnail.name),t=await httpRequestPut(`${APIURL}/artikel/editartikel`,a)):(a.set("thumbnail",fileThumbnail,fileThumbnail.name),t=await httpRequestPost(`${APIURL}/artikel/addartikel`,a)),hideLoadingSpinner(),201===t.status?(localStorage.removeItem("artikel-content"),setTimeout(()=>{Swal.fire({icon:"success",title:"<strong>SUCCESS</strong>",html:`artikel berhasil ${""==IDARTIKEL?"dipublish":"diedit"}!`,showCancelButton:!1,confirmButtonText:"ok"}).then(()=>{window.location.replace(`${BASEURL}/admin/listartikel`)})},300)):400===t.status&&t.message.title&&($("#title").addClass("is-invalid"),$("#title-error").text(t.message.title))}});let dataTemporaryContent=JSON.parse(localStorage.getItem("add-artikel"));"tambah artikel"===pageTitle2&&($("#formCrudArticle #published_at").on("change",e=>{saveTemporaryContent()}),$("#formCrudArticle #title").on("keyup",e=>{saveTemporaryContent()}),$("#formCrudArticle #kategori-artikel-wraper").on("change",e=>{saveTemporaryContent()}),$(".ql-editor").on("keyup",e=>{saveTemporaryContent()}));let fileThumbnail="";const changeThumbPreview=e=>{let t=e.files[0].type.split("/");if(!/image/.test(t[0]))return showAlert({message:"<strong>File yang anda upload bukan gambar!</strong>",autohide:!0,type:"danger"}),e.value="",!1;if(!["jpg","jpeg","png","webp"].includes(t[1]))return showAlert({message:"<strong>Format gambar yang diperbolehkan -> jpg/jpeg/png/webp!</strong>",autohide:!0,type:"danger"}),e.value="",!1;{const t=500,r=308,l="image/webp",n=.9,o=e.files[0],s=URL.createObjectURL(o),d=new Image;function a(e,t,a){let i=e.width,r=e.height;return i>r?i>t&&(r=Math.round(r*t/i),i=t):r>a&&(i=Math.round(i*a/r),r=a),[i,r]}function i(e,t){for(var a=e.split(","),i=a[0].match(/:(.*?);/)[1],r=atob(a[1]),l=r.length,n=new Uint8Array(l);l--;)n[l]=r.charCodeAt(l);return new File([n],t,{type:i})}$("#thumbnail-spinner").removeClass("d-none"),d.src=s,d.onload=function(){if(e.files[0].size<2e6)fileThumbnail=e.files[0],document.querySelector("#preview-thumbnail").src=s;else{URL.revokeObjectURL(this.src);const[e,o]=a(d,t,r),s=document.createElement("canvas");s.width=e,s.height=o;const m=s.getContext("2d");m.drawImage(d,0,0,e,o),s.toBlob(e=>{},l,n),document.querySelector("#preview-thumbnail").src=s.toDataURL(),fileThumbnail=i(s.toDataURL(),"thumbnail.webp")}$("#thumbnail-spinner").addClass("d-none")}}};