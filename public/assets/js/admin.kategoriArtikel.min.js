function doValidate(t){let a=!0;return $("#modalCrudKategori .form-control").removeClass("is-invalid"),$("#modalCrudKategori .text-danger").html(""),""==t.get("id")&&""==$("input#icon").val()&&($("input#icon").addClass("is-invalid"),a=!1),""==$("input#kategori_name").val()?($("input#kategori_name").addClass("is-invalid"),a=!1):$("input#kategori_name").val().length>100?($("input#kategori_name").addClass("is-invalid"),$("#kategori_name-error").html("*maximal 100 huruf"),a=!1):/[^A-Za-z0-9\| ]/g.test($("input#kategori_name").val())&&($("input#kategori_name").addClass("is-invalid"),$("#kategori_name-error").html("*hanya boleh huruf dan angka"),a=!1),arrayKatArtikel.forEach(e=>{""==t.get("id")?e.name.toLowerCase()==$("input#kategori_name").val().toLowerCase().trim()&&($("input#kategori_name").addClass("is-invalid"),$("#kategori_name-error").html("*kategori sudah tersedia"),a=!1):e.name.toLowerCase()==$("input#kategori_name").val().toLowerCase().trim()&&e.id!=t.get("id")&&($("input#kategori_name").addClass("is-invalid"),$("#kategori_name-error").html("*kategori sudah tersedia"),a=!1)}),""==$("#description").val()&&($("#description").addClass("is-invalid"),a=!1),a}const openModalCrudKategori=(t,a=null)=>{if($("#modalCrudKategori .form-control").removeClass("is-invalid"),"addkategori"==t)resetModal(),$("#modalCrudKategori .modal-title").html("Tambah kategori"),$("#modalCrudKategori .text-danger").html("");else{$("#modalCrudKategori .modal-title").html("Edit kategori");let t=arrayKatArtikel.filter(t=>t.id==a);$("#modalCrudKategori input[name=id]").val(t[0].id),$("#modalCrudKategori #img-preview").attr("src",t[0].icon),$("#modalCrudKategori input[name=kategori_name]").val(t[0].name),$("#modalCrudKategori textarea[name=description]").val(t[0].description),"1"==t[0].kategori_utama?($("#modalCrudKategori .btn-toggle input").val("1"),$("#modalCrudKategori .btn-toggle").addClass("active bg-success").removeClass("bg-secondary")):($("#modalCrudKategori .btn-toggle input").val("0"),$("#modalCrudKategori .btn-toggle").removeClass("active bg-success").addClass("bg-secondary"))}},resetModal=()=>{$("#modalCrudKategori .form-control").val(""),$("#modalCrudKategori .btn-toggle input").val("0"),$("#modalCrudKategori .btn-toggle").removeClass("active bg-success").addClass("bg-secondary"),$("#modalCrudKategori #img-preview").attr("src",`${BASEURL}/assets/images/skeleton-icon.png`)};$("#modalCrudKategori input[type=checkbox]").on("click",function(t){"1"==$(this).val()?($(this).val("0"),$(this).parent().removeClass("active bg-success").addClass("bg-secondary")):($(this).val("1"),$(this).parent().removeClass("bg-secondary").addClass("active bg-success"))});const changeThumbPreview=t=>{let a=t.files[0].type.split("/");if(!/image/.test(a[0]))return showAlert({message:"<strong>File yang anda upload bukan gambar!</strong>",autohide:!0,type:"danger"}),t.value="",!1;if(!["jpg","jpeg","png","webp"].includes(a[1]))return showAlert({message:"<strong>Format gambar yang diperbolehkan -> jpg/jpeg/png/webp!</strong>",autohide:!0,type:"danger"}),t.value="",!1;if(t.files[0].size>2e6)return showAlert({message:"ukuran gambar maksimal 2mb",autohide:!0,type:"danger"}),t.value="",!1;{const a=t.files[0],e=URL.createObjectURL(a);document.querySelector("#img-preview").src=e}},crudKategoriArtikel=async(t,a)=>{a.preventDefault();let e=new FormData(t.parentElement.parentElement);if(doValidate(e)){let t="";$("#modalCrudKategori button #text").addClass("d-none"),$("#modalCrudKategori button #spinner").removeClass("d-none"),"1"==$("#modalCrudKategori #kategori_utama").val()?e.set("kategori_utama","1"):e.set("kategori_utama","0"),t=""==e.get("id")?await httpRequestPost(`${APIURL}/artikel/addkategori`,e):await httpRequestPut(`${APIURL}/artikel/editkategori`,e),$("#modalCrudKategori button #text").removeClass("d-none"),$("#modalCrudKategori button #spinner").addClass("d-none"),201===t.status?(""==e.get("id")&&resetModal(),getAllKatArtikel(),showAlert({message:`<strong>Success...</strong> kategori berhasil ${""==e.get("id")?"ditambah":"diedit"}!`,autohide:!0,type:"success"})):400===t.status&&"kategori utama maksimal 3"==t.message&&showAlert({message:"<strong>Gagal...</strong> kategori utama sudah melebihi 3!",autohide:!0,type:"warning"})}};let arrayKatArtikel=[];const getAllKatArtikel=async()=>{$("#search-kategori").val(""),$("#table-kategori-artikel tbody").html(""),$("#list-kategori-notfound").addClass("d-none"),$("#list-kategori-spinner").removeClass("d-none");let t=await httpRequestGet(`${APIURL}/artikel/getkategori`);if($("#list-kategori-spinner").addClass("d-none"),404==t.status&&(arrayKatArtikel=[],$("#list-kategori-notfound").removeClass("d-none"),$("#list-kategori-notfound #text-notfound").html("kategori belum ditambah")),200===t.status){let a="";arrayKatArtikel=t.data.data,t.data.data.forEach((t,e)=>{a+=`<tr class="text-xs">\n                <td class="align-middle text-center" style="max-width:40px;">\n                    <span class="font-weight-bold"> ${++e} </span>\n                </td>\n                <td class="align-middle text-center py-3" style="max-width:100px;">\n                    <img src="${t.icon}" class="img-thumbnail" style="width:100px;height:100px;max-width:100px;max-height:100px;">\n                </td>\n                <td class="align-middle text-center">\n                    ${t.name}\n                </td>\n                <td class="align-middle text-center" style="max-width:150px;white-space: pre-wrap;"><div style="max-height:100px;overflow: auto;">${t.description}</div></td>\n                <td class="align-middle text-center ${"1"==t.kategori_utama?"bg-success":"bg-warning"}">\n                    <i class="text-white ${"1"==t.kategori_utama?"fas fa-check ":"fas fa-times"}" style="font-size:30px;"></i>\n                </td>\n                <td class="align-middle text-center">\n                    <a href='' data-toggle="modal" data-target="#modalCrudKategori" class="badge badge-warning text-xxs pb-1 rounded cursor-pointer" onclick="openModalCrudKategori('editkategori','${t.id}');">edit</a>\n                    <a href='' id="${t.id}" class="badge badge-danger text-xxs pb-1 rounded cursor-pointer" onclick="hapusKategori('${t.id}','${t.name}',event)">hapus</a>\n                </td>\n             </tr>`}),$("#table-kategori-artikel tbody").html(a)}};getAllKatArtikel(),$("#search-kategori").on("keyup",function(){let t="",a=[];a=""===$(this).val()?arrayKatArtikel:arrayKatArtikel.filter(t=>t.name.includes($(this).val().toLowerCase())),0==a.length?($("#list-kategori-notfound").removeClass("d-none"),$("#list-kategori-notfound #text-notfound").html("kategori belum ditambah")):($("#list-kategori-notfound").addClass("d-none"),$("#list-kategori-notfound #text-notfound").html(""),a.forEach((a,e)=>{t+=`<tr class="text-xs">\n                <td class="align-middle text-center" style="max-width:40px;">\n                    <span class="font-weight-bold"> ${++e} </span>\n                </td>\n                <td class="align-middle text-center py-3" style="max-width:100px;">\n                    <img src="${a.icon}" class="img-thumbnail" style="width:100px;height:100px;max-width:100px;max-height:100px;">\n                </td>\n                <td class="align-middle text-center">\n                    ${a.name}\n                </td>\n                <td class="align-middle text-center" style="max-width:150px;white-space: pre-wrap;"><div style="max-height:100px;overflow: auto;">${a.description}</div></td>\n                <td class="align-middle text-center ${"1"==a.kategori_utama?"bg-success":"bg-warning"}">\n                    <i class="text-white ${"1"==a.kategori_utama?"fas fa-check ":"fas fa-times"}" style="font-size:30px;"></i>\n                </td>\n                <td class="align-middle text-center">\n                    <a href='' data-toggle="modal" data-target="#modalCrudKategori" class="badge badge-warning text-xxs pb-1 rounded cursor-pointer" onclick="openModalCrudKategori('editkategori','${a.id}');">edit</a>\n                    <a href='' id="${a.id}" class="badge badge-danger text-xxs pb-1 rounded cursor-pointer" onclick="hapusKategori('${a.id}','${a.name}',event)">hapus</a>\n                </td>\n            </tr>`})),$("#table-kategori-artikel tbody").html(t)});const hapusKategori=(t,a,e)=>{e.preventDefault(),Swal.fire({title:"ANDA YAKIN?",text:`berita dengan kategori '${a}' akan terhapus juga`,icon:"warning",showCancelButton:!0,confirmButtonText:"iya"}).then(a=>{a.isConfirmed&&Swal.fire({input:"password",inputAttributes:{autocapitalize:"off"},html:"<h5 class='mb-4'>Password</h5>",showCancelButton:!0,confirmButtonText:"submit",showLoaderOnConfirm:!0,preConfirm:a=>{let e=new FormData;return e.append("hashedpass",PASSADMIN),e.append("password",a),axios.post(`${APIURL}/admin/confirmdelete`,e,{headers:{}}).then(a=>httpRequestDelete(`${APIURL}/artikel/deletekategori?id=${t}`).then(t=>{201==t.status&&getAllKatArtikel()})).catch(t=>{404==t.response.status?Swal.showValidationMessage("password salah"):500==t.response.status&&Swal.showValidationMessage("terjadi kesalahan, coba sekali lagi")})},allowOutsideClick:()=>!Swal.isLoading()})})};