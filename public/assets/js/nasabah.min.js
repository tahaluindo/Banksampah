function validateFormEditProfile(a){let t=!0,e=a.get("kelamin"),s=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;$("#formEditProfile .form-control").removeClass("is-invalid"),$("#formEditProfile .form-check-input").removeClass("is-invalid"),$("#formEditProfile .text-danger").html(""),""==$("#nama-edit").val()?($("#nama-edit").addClass("is-invalid"),$("#nama-edit-error").html("*nama lengkap harus di isi"),t=!1):$("#nama-edit").val().length>40&&($("#nama-edit").addClass("is-invalid"),$("#nama-edit-error").html("*maksimal 40 huruf"),t=!1),""==$("#username-edit").val()?($("#username-edit").addClass("is-invalid"),$("#username-edit-error").html("*username harus di isi"),t=!1):$("#username-edit").val().length<8||$("#username-edit").val().length>20?($("#username-edit").addClass("is-invalid"),$("#username-edit-error").html("*minimal 8 huruf dan maksimal 20 huruf"),t=!1):/\s/.test($("#username-edit").val())&&($("#username-edit").addClass("is-invalid"),$("#username-edit-error").html("*tidak boleh ada spasi"),t=!1),""==$("#email-edit").val()?($("#email-edit").addClass("is-invalid"),$("#email-edit-error").html("*email harus di isi"),t=!1):s.test(String($("#email-edit").val()).toLowerCase())||($("#email-edit").addClass("is-invalid"),$("#email-edit-error").html("*email tidak valid"),t=!1),""==$("#tgllahir-edit").val()&&($("#tgllahir-edit").addClass("is-invalid"),$("#tgllahir-edit-error").html("*tgl lahir harus di isi"),t=!1),null==e&&($("#formEditProfile .form-check-input").addClass("is-invalid"),t=!1);let i="";return nikParse($("#nik-edit").val(),function(a){i=a}),""==$("#nik-edit").val()?($("#nik-edit").addClass("is-invalid"),$("#nik-edit-error").html("*NIK harus di isi"),t=!1):"error"==i.status&&($("#nik-edit").addClass("is-invalid"),$("#nik-edit-error").html(i.pesan),t=!1),""==$("#notelp-edit").val()?($("#notelp-edit").addClass("is-invalid"),$("#notelp-edit-error").html("*no.telp harus di isi"),t=!1):$("#notelp-edit").val().length>14?($("#notelp-edit").addClass("is-invalid"),$("#notelp-edit-error").html("*maksimal 14 huruf"),t=!1):/^\d+$/.test($("#notelp-edit").val())||($("#notelp-edit").addClass("is-invalid"),$("#notelp-edit-error").html("*hanya boleh angka"),t=!1),""==$("#alamat-edit").val()?($("#alamat-edit").addClass("is-invalid"),$("#alamat-edit-error").html("*alamat harus di isi"),t=!1):$("#alamat-edit").val().length>255&&($("#alamat-edit").addClass("is-invalid"),$("#alamat-edit-error").html("*maksimal 255 huruf"),t=!1),""!==$("#newpass-edit").val()&&($("#newpass-edit").val().length<8||$("#newpass-edit").val().length>20?($("#newpass-edit").addClass("is-invalid"),$("#newpass-edit-error").html("*minimal 8 huruf dan maksimal 20 huruf"),t=!1):/\s/.test($("#newpass-edit").val())&&($("#newpass-edit").addClass("is-invalid"),$("#newpass-edit-error").html("*tidak boleh ada spasi"),t=!1),""==$("#oldpass-edit").val()&&($("#oldpass-edit").addClass("is-invalid"),$("#oldpass-edit-error").html("*password lama harus di isi"),t=!1)),t}const getSampahMasuk=async()=>{let a=await httpRequestGet(`${APIURL}/transaksi/sampahmasuk`);if(200===a.status){let t=a.data.data;for(const a in t)$(`#sampah-${a.replace(/\s/g,"-")}`).html(parseFloat(t[a].total).toFixed(1)+" Kg")}},openModalSampahMasuk=async a=>{$("#modalDetailSampah .modal-title").html(`kategori ${a}`),$("#detil-sampah-spinner").removeClass("d-none"),$("#detil-sampah-notfound").addClass("d-none"),$("#modalDetailSampah #table-jenis-wraper").html("");let t=await httpRequestGet(`${APIURL}/transaksi/sampahmasuk?kategori=${a}`);if($("#detil-sampah-spinner").addClass("d-none"),404===t.status)$("#detil-sampah-notfound").removeClass("d-none");else if(200===t.status){let a="",e=t.data.data;e.forEach((t,e)=>{a+=`<tr class="text-center">\n                <th scope="row">${++e}</th>\n                <td>${t.jenis}</td>\n                <td>${parseFloat(t.jumlah_kg).toFixed(2)} kg</td>\n            </tr>`}),$("#modalDetailSampah #table-jenis-wraper").html(`<table class="table table-striped">\n            <thead>\n                <tr class="text-center">\n                    <th scope="col">#</th>\n                    <th scope="col">Jenis sampah</th>\n                    <th scope="col">Jumlah</th>\n                </tr>\n            </thead>\n            <tbody>\n                ${a}\n            </tbody>\n        </table>`)}};let openModalFilterT=a=>{$("#formFilterTransaksi .modal-title").html(a);let t=a.toLowerCase().replace(" ","-"),e=$(`#btn-${t} #startdate`).html().split("/"),s=$(`#btn-${t} #enddate`).html().split("/");$("#formFilterTransaksi input[name=date-start]").val(`${e[2]}-${e[1]}-${e[0]}`),$("#formFilterTransaksi input[name=date-end]").val(`${s[2]}-${s[1]}-${s[0]}`)};$("#formFilterTransaksi input[type=date]").on("change",function(a){let t=$("#formFilterTransaksi input[name=date-start]").val(),e=$("#formFilterTransaksi input[name=date-end]").val();t&&e?($("#btn-filter-transaksi").attr("data-dismiss","modal"),$("#btn-filter-transaksi").attr("onclick","filterTransaksi(this,event);"),$("#formFilterTransaksi input[type=date]").removeClass("is-invalid")):($("#btn-filter-transaksi").removeAttr("data-dismiss"),$("#btn-filter-transaksi").removeAttr("onclick"),""==t&&$("#formFilterTransaksi input[name=date-start]").addClass("is-invalid"),""==e&&$("#formFilterTransaksi input[name=date-end]").addClass("is-invalid"))});let dateStartGrafik="",dateEndGrafik="",dateStartHistori="",dateEndHistori="",setCurrentStartDate=()=>{let a=new Date((new Date).getTime()),t=a.toLocaleString("en-US",{day:"2-digit"}),e=a.toLocaleString("en-US",{month:"2-digit"}),s=a.toLocaleString("en-US",{year:"numeric"}),i=new Date(a.getTime()-2592e6),n=i.toLocaleString("en-US",{day:"2-digit"}),r=i.toLocaleString("en-US",{month:"2-digit"}),l=i.toLocaleString("en-US",{year:"numeric"});dateStartGrafik=`${n}-${r}-${l}`,dateEndGrafik=`${t}-${e}-${s}`,dateStartHistori=`${n}-${r}-${l}`,dateEndHistori=`${t}-${e}-${s}`,$("#btn-filter-grafik #startdate").html(`${n}/${r}/${l}`),$("#btn-filter-grafik #enddate").html(`${t}/${e}/${s}`),$("#btn-filter-histori #startdate").html(`${n}/${r}/${l}`),$("#btn-filter-histori #enddate").html(`${t}/${e}/${s}`)};setCurrentStartDate();const filterTransaksi=async a=>{let t=new FormData(a.parentElement.parentElement.parentElement),e=t.get("date-start").split("-"),s=t.get("date-end").split("-"),i=new Date(`${e[0]}/${e[1]}/${e[2]} 00:00:01`).getTime(),n=new Date(`${s[0]}/${s[1]}/${s[2]} 23:00:00`).getTime();if(parseInt(n)-parseInt(i)>2674799e3)return showAlert({message:"maksimal 31 hari",autohide:!0,type:"danger"}),0;"Filter Histori"==$("#formFilterTransaksi .modal-title").html()?(dateStartHistori=`${e[2]}-${e[1]}-${e[0]}`,dateEndHistori=`${s[2]}-${s[1]}-${s[0]}`,$("#btn-filter-histori #startdate").html(`${e[2]}/${e[1]}/${e[0]}`),$("#btn-filter-histori #enddate").html(`${s[2]}/${s[1]}/${s[0]}`),getHistoriTransaksi()):(dateStartGrafik=`${e[2]}-${e[1]}-${e[0]}`,dateEndGrafik=`${s[2]}-${s[1]}-${s[0]}`,$("#btn-filter-grafik #startdate").html(`${e[2]}/${e[1]}/${e[0]}`),$("#btn-filter-grafik #enddate").html(`${s[2]}/${s[1]}/${s[0]}`))};let chartGrafik="",grafikSetorYear=(new Date).getFullYear(),grafikSetorUrl=`${APIURL}/transaksi/grafikssampah?year=${grafikSetorYear}&tampilan=per-bulan`;const getDataGrafikSetor=async()=>{$("#spinner-wraper-grafik").removeClass("d-none");let a=await httpRequestGet(grafikSetorUrl);$("#spinner-wraper-grafik").addClass("d-none");let t="line",e=[""],s=[0];if(200===a.status){let t=a.data.data;for(const a in t)e.push(a),s.push(t[a].totSampahMasuk)}""!=chartGrafik&&chartGrafik.destroy();var i=document.getElementById("chart-line").getContext("2d");document.querySelector("#chart-line").style.width="100%",document.querySelector("#chart-line").style.height="300px",document.querySelector("#chart-line").style.maxHeight="300px";var n=i.createLinearGradient(0,230,0,50);n.addColorStop(1,"rgba(193,217,102,0.2)");var r=i.createLinearGradient(0,230,0,50);r.addColorStop(1,"rgba(193,217,102,0.2)");for(let a=e.length;a<10;a++)e.push(" ");"line"==t&&1==s.length&&(s=[],e.unshift("")),chartGrafik=new Chart(i,{type:t,data:{labels:e,datasets:[{label:"Kg",tension:.4,borderWidth:0,pointRadius:0,borderColor:"#c1d966",borderWidth:3,backgroundColor:n,fill:!0,data:s,maxBarThickness:6,minBarLength:6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{grid:{drawBorder:!1,display:!0,drawOnChartArea:!0,drawTicks:!1,borderDash:[5,5]},ticks:{display:!0,padding:10,color:"#b2b9bf",beginAtZero:!0,font:{size:11,family:"Open Sans",style:"normal",lineHeight:2}}},x:{grid:{drawBorder:!1,display:!1,drawOnChartArea:!1,drawTicks:!1,borderDash:[5,5]},ticks:{display:!0,color:"#b2b9bf",padding:0,font:{size:11,family:"Open Sans",style:"normal",lineHeight:2}}}}}})};getDataGrafikSetor(),$("select[name=tahun-grafik-setor]").on("change",function(){grafikSetorYear=$(this).val(),grafikSetorUrl=`${APIURL}/transaksi/grafikssampah?year=${grafikSetorYear}&tampilan=per-bulan`,getDataGrafikSetor()});const getHistoriTransaksi=async()=>{$("#spinner-wraper-histori").removeClass("d-none"),$("#transaksi-wraper-histori").addClass("d-none");let a=await httpRequestGet(`${APIURL}/transaksi/getdata?start=${dateStartHistori}&end=${dateEndHistori}&orderby=terbaru`);if($("#spinner-wraper-histori").addClass("d-none"),$("#transaksi-wraper-histori").removeClass("d-none"),404===a.status)$("#transaksi-wraper-histori").html("<h6 class='opacity-6'>belum ada transaksi</h6>");else if(200===a.status){let t="",e=a.data.data;e.forEach(a=>{let e="",s="",i=a.jenis_transaksi,n=a.jenis_saldo,r=new Date(1e3*parseInt(a.date)),l=r.toLocaleString("en-US",{day:"numeric"}),d=r.toLocaleString("en-US",{month:"long"}),o=r.toLocaleString("en-US",{year:"numeric"});"penyetoran sampah"==i?(e="text-success",s="+ Rp"+modifUang(a.total_uang_setor)):"konversi saldo"==i?(e="text-warning",s="Rp"+modifUang(kFormatter(a.total_pindah))+' <i class="fas fa-exchange-alt"></i> '+parseFloat(a.hasil_konversi).toFixed(4)+"g"):(e="text-danger",s="uang"==n?"- Rp"+modifUang(parseFloat(a.total_tarik).toFixed(0)):"- "+parseFloat(a.total_tarik).toFixed(4)+"g"),t+=`<li class="list-group-item border-0 ps-0 border-radius-lg">\n                <div class="d-flex justify-content-between">\n                    <div class="d-flex flex-column">\n                        <h6 class="mb-1 text-dark font-weight-bold text-sm">${d}, ${l}, ${o}</h6>\n                        <span class="text-xs">ID: ${a.id_transaksi}</span>\n                        <span class="${e} mt-2">${s}</span>\n                    </div>\n                    <div class="d-flex align-items-center text-sm">\n                        <a href='' class="btn btn-link text-dark text-sm mb-0 px-0 ms-4"  data-toggle="modal" data-target="#modalPrintTransaksi" onclick="getDetailTransaksiNasabah('${a.id_transaksi}');">\n                            <i class="fas fa-file-pdf text-lg me-1"></i> PDF\n                        </a>\n                    </div>\n                </div>\n                <hr class="horizontal dark mt-2">\n            </li>`}),$("#transaksi-wraper-histori").html(`<ul class="list-group h-100 w-100" style="font-family: 'qc-medium';">\n            ${t}\n        </ul>`)}},getDetailTransaksiNasabah=async a=>{$("#detil-transaksi-body").html(" "),$("#detil-transaksi-spinner").removeClass("d-none");let t=await httpRequestGet(`${APIURL}/transaksi/getdata?id_transaksi=${a}`);if(200===t.status){$("#detil-transaksi-spinner").addClass("d-none");let a=new Date(1e3*parseInt(t.data.data.date)),e=a.toLocaleString("en-US",{day:"numeric"}),s=a.toLocaleString("en-US",{month:"numeric"}),i=a.toLocaleString("en-US",{year:"numeric"}),n=a.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"});if($("#detil-transaksi-date").html(`${e}/${s}/${i}&nbsp;&nbsp;&nbsp;${n}`),$("#detil-transaksi-nama").html(t.data.data.nama_lengkap),$("#detil-transaksi-idnasabah").html(t.data.data.id_user),$("#detil-transaksi-idtransaksi").html(t.data.data.id_transaksi),$("#detil-transaksi-type").html(t.data.data.jenis_transaksi),$("#btn-cetak-transaksi").attr("href",`${BASEURL}/transaksi/cetaktransaksi/${t.data.data.id_transaksi}`),"penarikan saldo"==t.data.data.jenis_transaksi){let a=t.data.data.jenis_saldo,e="uang"==a?"Rp "+modifUang(parseFloat(t.data.data.jumlah_tarik).toFixed(0)):parseFloat(t.data.data.jumlah_tarik).toFixed(4)+" gram";$("#detil-transaksi-body").html(`<div class="p-4 bg-secondary border-radius-sm">\n                <table>\n                    <tr class="text-dark">\n                        <td><h4>Jenis saldo&nbsp;</h4></td>\n                        <td>\n                            <h4>\n                            : &nbsp;&nbsp;${"uang"==a?a:"emas "+a}\n                            </h4>\n                        </td>\n                    </tr>\n                    <tr class="text-dark">\n                        <td><h4>Jumlah</h4></td>\n                        <td><h4>: &nbsp;&nbsp;${e}</h4></td>\n                    </tr>\n                </table>\n            </div>`)}if("konversi saldo"==t.data.data.jenis_transaksi&&$("#detil-transaksi-body").html(`<div class="p-4 bg-secondary border-radius-sm">\n            <table>\n                <tr class="text-dark">\n                    <td>Jumlah</td>\n                    <td>: &nbsp;&nbsp;Rp ${modifUang(t.data.data.jumlah)}</td>\n                </tr>\n                <tr class="text-dark">\n                    <td>Harga emas</td>\n                    <td>: &nbsp;&nbsp;Rp ${modifUang(t.data.data.harga_emas)}</td>\n                </tr>\n                <tr class="text-dark">\n                    <td>Hasil konversi&nbsp;</td>\n                    <td>\n                        : &nbsp;&nbsp;${parseFloat(t.data.data.hasil_konversi).toFixed(4)} g\n                    </td>\n                </tr>\n            </table>\n            </div>`),"penyetoran sampah"==t.data.data.jenis_transaksi){let a=0,e=0,s="",i=t.data.data.barang;i.forEach((t,i)=>{a+=parseFloat(t.jumlah_rp),e+=parseFloat(t.jumlah_kg),s+=`<tr class="text-center">\n                    <th scope="row">${++i}</th>\n                    <td>${t.jenis}</td>\n                    <td>${parseFloat(t.jumlah_kg).toFixed(2)} kg</td>\n                    <td class="text-right">${modifUang(t.jumlah_rp)}</td>\n                </tr>`}),$("#detil-transaksi-body").html(`<table class="table table-striped">\n                <thead>\n                    <tr>\n                        <th scope="col">#</th>\n                        <th scope="col">Jenis sampah</th>\n                        <th scope="col">Jumlah</th>\n                        <th scope="col">Harga</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${s}\n                    <tr>\n                        <th class="text-center" colspan='2'>Total</th>\n                        <td class="text-center">${parseFloat(e).toFixed(2)}</td>\n                        <td class="text-center">${modifUang(a.toString())}</td>\n                    </tr>\n                </tbody>\n            </table>`)}}},getDataSaldo=async()=>{$("#saldo-uang").html("_ _"),$("#saldo-emas").html("_ _");let a=await httpRequestGet(`${APIURL}/transaksi/getsaldo`);if(200===a.status){let t=a.data.data;$("#saldo-uang").html(modifUang(t.uang.toString())),$("#saldo-emas").html(parseFloat(t.emas||0).toFixed(4))}},getAllJenisSampah=async()=>{$("#list-sampah-notfound").addClass("d-none"),$("#table-jenis-sampah").addClass("d-none"),$("#list-sampah-spinner").removeClass("d-none");let a=await httpRequestGet(`${APIURL}/sampah/getsampah`);if($("#table-jenis-sampah").removeClass("d-none"),$("#list-sampah-spinner").addClass("d-none"),404===a.status)$("#list-sampah-notfound").removeClass("d-none"),$("#list-sampah-notfound #text-notfound").html("jenis sampah belum ditambah");else if(200===a.status){let t="",e=sortingSampah(a.data.data);arrayJenisSampah=e,e.forEach((a,e)=>{t+=`<tr class="text-xs">\n                <td class="align-middle text-center py-3">\n                    <span class="font-weight-bold"> ${++e} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold"> ${a.kategori} </span>\n                </td>\n                <td class="align-middle text-center">\n                ${a.jenis}\n                </td>\n                <td class="align-middle text-center py-3">\n                    <span class="font-weight-bold">Rp. ${modifUang(a.harga)} </span>\n                </td>\n            </tr>`}),$("#table-jenis-sampah tbody").html(t)}},sortingSampah=a=>{let t=[],e={},s=[];a.forEach(a=>{t.includes(a.kategori)||t.push(a.kategori.replace(/\s/g,"_"))}),t.forEach(t=>{e[t]=a.filter(a=>a.kategori==t.replace(/_/g," "))});for(let a in e)e[a].forEach(a=>{s.push(a)});return s};let dataNasabah="";const getDataProfile=async()=>{let a=await httpRequestGet(`${APIURL}/nasabah/getprofile`);200===a.status&&(dataNasabah=a.data.data,"dashboard"==pageTitle2?updateNasabahCard(dataNasabah):"profile"==pageTitle2&&updatePersonalInfo(dataNasabah))},updateNasabahCard=a=>{let t=new Date(1e3*parseInt(a.created_at));$("#card-id").html(`${a.id.slice(0,5)}&nbsp;&nbsp;&nbsp;${a.id.slice(5,11)}&nbsp;&nbsp;&nbsp;${a.id.slice(11,99999999)}`),$("#card-username").html(a.username),$("#card-date").html(`${t.toLocaleString("en-US",{day:"numeric"})}/${t.toLocaleString("en-US",{month:"numeric"})}/${t.toLocaleString("en-US",{year:"numeric"})}`)},updatePersonalInfo=a=>{$("#profile-spinner").addClass("d-none"),$("#email").html(a.email),$("#idnasabah").html(a.id),$("#nama-lengkap").html(a.nama_lengkap),$("#username").html(a.username),$("#tgl-lahir").html(a.tgl_lahir),$("#kelamin").html(a.kelamin),$("#alamat").html(a.alamat),$("#notelp").html(a.notelp),$("#nik").html(a.nik)};$("#btn-edit-profile").on("click",function(a){a.preventDefault(),$("#formEditProfile .form-control").removeClass("is-invalid"),$("#formEditProfile .form-check-input").removeClass("is-invalid"),$("#formEditProfile .text-danger").html("");for(const a in dataNasabah)$(`#formEditProfile input[name=${a}]`).val(dataNasabah[a]);let t=dataNasabah.tgl_lahir.split("-");$("#formEditProfile input[name=tgl_lahir]").val(`${t[2]}-${t[1]}-${t[0]}`),$(`#formEditProfile input#kelamin-${dataNasabah.kelamin}`).prop("checked",!0),$("#newpass-edit").val(""),$("#oldpass-edit").val("")}),$("#formEditProfile .form-check-input").on("click",function(a){$("#formEditProfile input[name=kelamin]").val($(this).val()),$("#formEditProfile .form-check-input").prop("checked",!1),$(this).prop("checked",!0)}),$("#formEditProfile").on("submit",async function(a){a.preventDefault();let t=new FormData(a.target);if(validateFormEditProfile(t)){let a=t.get("tgl_lahir").split("-");if(t.set("tgl_lahir",`${a[2]}-${a[1]}-${a[0]}`),""==t.get("new_password")&&t.delete("new_password"),$("#formEditProfile button#submit #text").addClass("d-none"),$("#formEditProfile button#submit #spinner").removeClass("d-none"),httpResponse=await httpRequestPut(`${APIURL}/nasabah/editprofile`,t),$("#formEditProfile button#submit #text").removeClass("d-none"),$("#formEditProfile button#submit #spinner").addClass("d-none"),201===httpResponse.status){""!=t.get("new_password")&&($("#newpass-edit").val(""),$("#oldpass-edit").val(""));let a={};for(var e of t.entries())a[e[0]]=e[1];dataNasabah=a,updatePersonalInfo(a),showAlert({message:"<strong>Success...</strong> edit profile berhasil!",autohide:!0,type:"success"})}else 400===httpResponse.status&&(httpResponse.message.username&&($("#username-edit").addClass("is-invalid"),$("#username-edit-error").text("*"+httpResponse.message.username)),httpResponse.message.email&&($("#email-edit").addClass("is-invalid"),$("#email-edit-error").text("*"+httpResponse.message.email)),httpResponse.message.nik&&($("#nik-edit").addClass("is-invalid"),$("#nik-edit-error").text("*"+httpResponse.message.nik)),httpResponse.message.notelp&&($("#notelp-edit").addClass("is-invalid"),$("#notelp-edit-error").text("*"+httpResponse.message.notelp)),httpResponse.message.old_password&&($("#oldpass-edit").addClass("is-invalid"),$("#oldpass-edit-error").text("*"+httpResponse.message.old_password)))}}),"dashboard"===pageTitle2&&(getSampahMasuk(),getHistoriTransaksi(),getDataSaldo(),getAllJenisSampah()),getDataProfile();