function validateAddKategori(){let a=!0;return""==$("input#NewkategoriSampah").val()?(showAlert({message:"<strong>Masukan kategori baru !</strong>",autohide:!0,type:"danger"}),a=!1):$("input#NewkategoriSampah").val().length>100&&(showAlert({message:"<strong>Kategori baru maximal 100 huruf !</strong>",autohide:!0,type:"danger"}),a=!1),arrayKatSampah.forEach(t=>{t.name.toLowerCase()==$("input#NewkategoriSampah").val().toLowerCase().trim()&&(showAlert({message:"<strong>Kategori sudah tersedia !</strong>",autohide:!0,type:"danger"}),a=!1)}),a}let arrayKatSampah=[];const getAllKatSampah=async()=>{$("#kategori-sampah-wraper").html(`<div class="position-absolute bg-white d-flex align-items-center justify-content-center" style="z-index: 10;top: 0;bottom: 0;left: 0;right: 0;">\n        <img src="${BASEURL}/assets/images/spinner.svg" style="width: 20px;" />\n    </div>`);let a="<option value='' selected>-- pilih kategori --</option>",t="<option value='' selected>-- semua kategori --</option>",e=await httpRequestGet(`${APIURL}/sampah/getkategori`);if(404===e.status)arrayKatSampah=[],$("#kategori-sampah-wraper").html('<div class="position-absolute bg-white d-flex align-items-center justify-content-center" style="z-index: 10;top: 0;bottom: 0;left: 0;right: 0;">\n            <h6 style="opacity: 0.6;">kategori belum tersedia</h6>\n        </div>');else if(200===e.status){let s="",d=e.data.data;arrayKatSampah=e.data.data,d.forEach(e=>{a+=`<option id="${e.id}" value="${e.id}">${e.name}</option>`,t+=`<option id="${e.name}" value="${e.name}">${e.name}</option>`,s+=`\n            <div class="w-100">\n                <div class="kategori-list w-100 d-flex justify-content-between align-items-center px-3 py-2">\n                    <div class="d-flex align-items-center text-md" style="flex: 1;">\n                        ${e.name}\n                    </div>\n                    <a href='' id="${e.id}" class="badge badge-danger border-radius-sm cursor-pointer" onclick="hapusKatSampahVal('${e.id}','${e.name}',event)">\n                        <i class="fas fa-trash text-white"></i>\n                    </a>\n                </div>\n                <hr class="horizontal dark mt-0">\n            </div>`}),$("#kategori-sampah-wraper").html(s)}$("#select-sampah-wraper").html(a),$("#formFilterSampah select[name=kategori]").html(t)};getAllKatSampah(),$("#btnAddKategoriSampah").on("click",async function(a){if(a.preventDefault(),validateAddKategori()){let a=new FormData;a.append("kategori_name",$("input#NewkategoriSampah").val().trim().toLowerCase()),$("#btnAddKategoriSampah #text").addClass("d-none"),$("#btnAddKategoriSampah #spinner").removeClass("d-none");let t=await httpRequestPost(`${APIURL}/sampah/addkategori`,a);$("#btnAddKategoriSampah #text").removeClass("d-none"),$("#btnAddKategoriSampah #spinner").addClass("d-none"),201===t.status&&($("input#NewkategoriSampah").val(""),getAllKatSampah(),showAlert({message:"<strong>Success...</strong> kategori berhasil ditambah!",autohide:!0,type:"success"}))}});const hapusKatSampahVal=(a,t,e)=>{e.preventDefault(),Swal.fire({title:"ANDA YAKIN?",text:`semua sampah dengan kategori '${t}' akan ikut terhapus`,icon:"warning",showCancelButton:!0,confirmButtonText:"iya"}).then(e=>{e.isConfirmed&&Swal.fire({input:"password",inputAttributes:{autocapitalize:"off"},html:"<h5 class='mb-4'>Password</h5>",showCancelButton:!0,confirmButtonText:"submit",showLoaderOnConfirm:!0,preConfirm:e=>{let s=new FormData;return s.append("hashedpass",PASSADMIN),s.append("password",e),axios.post(`${APIURL}/admin/confirmdelete`,s,{headers:{}}).then(e=>($("#formAddEditSampah input[name=kategori]").val()==t&&$("#formAddEditSampah input[name=kategori]").val(""),httpRequestDelete(`${APIURL}/sampah/deletekategori?id=${a}`).then(a=>{201==a.status?(getAllKatSampah(),getAllJenisSampah()):400==a.status&&showAlert({message:`<strong>Gagal . . .</strong> ${a.message}`,autohide:!0,type:"danger"})}))).catch(a=>{404==a.response.status?Swal.showValidationMessage("password salah"):500==a.response.status&&Swal.showValidationMessage("terjadi kesalahan, coba sekali lagi")})},allowOutsideClick:()=>!Swal.isLoading()})})},filterSampah=async a=>{let t=new FormData(a.parentElement.parentElement.parentElement),e=`${t.get("orderby")} - `;sampahUrl=`${APIURL}/sampah/getsampah?orderby=${t.get("orderby")}`,t.get("kategori")&&(e+=`${t.get("kategori")}`,sampahUrl+=`&kategori=${t.get("kategori")}`),""==t.get("kategori")&&(e=`${t.get("orderby")} - semua kategori`,sampahUrl=`${APIURL}/sampah/getsampah?orderby=${t.get("orderby")}`),console.log(sampahUrl),$("#ket-filter").html(e),getAllJenisSampah()},resetFilterSampah=async a=>{$("#formFilterSampah select[name=orderby]").val("terlama"),$("#formFilterSampah select[name=kategori]").val("")};let arrayJenisSampah=[],sampahUrl=`${APIURL}/sampah/getsampah?orderby=terlama`;const getAllJenisSampah=async()=>{$("#search-sampah").val(""),$("#ket-total").html("0"),$("#table-jenis-sampah tbody").html(""),$("#list-sampah-notfound").addClass("d-none"),$("#list-sampah-spinner").removeClass("d-none");let a=await httpRequestGet(sampahUrl);if($("#list-sampah-spinner").addClass("d-none"),404===a.status)$("#list-sampah-notfound").removeClass("d-none"),$("#list-sampah-notfound #text-notfound").html("jenis sampah belum ditambah");else if(200===a.status){let t="",e=sortingSampah(a.data.data);arrayJenisSampah=e,e.forEach((a,e)=>{t+=`<tr class="text-xs">\n                <td class="align-middle text-center py-3">\n                    <span class="font-weight-bold"> ${++e} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <span class="font-weight-bold"> ${a.kategori} </span>\n                </td>\n                <td class="align-middle text-center">\n                    ${a.jenis}\n                </td>\n                <td class="align-middle text-center py-3">\n                    <span class="font-weight-bold">Rp. ${modifUang(a.harga_pusat)} </span>\n                </td>\n                <td class="align-middle text-center py-3">\n                    <span class="font-weight-bold">Rp. ${modifUang(a.harga)} </span>\n                </td>\n                <td class="align-middle text-center py-3">\n                    <span class="font-weight-bold"> ${parseFloat(a.jumlah).toFixed(2)} </span>\n                </td>\n                <td class="align-middle text-center">\n                    <a href="" class="badge badge-danger text-xxs pb-1 rounded-sm cursor-pointer" onclick="hapusSampah('${a.id}',event)" style="border-radius:4px;">hapus</a>\n                    <a href="" class="badge badge-warning text-xxs pb-1 rounded-sm cursor-pointer" data-toggle="modal" data-target="#modalAddEditSampah" onclick="openModalAddEditSmp('editasampah','${a.id}')" style="border-radius:4px;">edit</a>\n                </td>\n            </tr>`}),$("#ket-total").html(e.length),$("#table-jenis-sampah tbody").html(t)}};getAllJenisSampah();const sortingSampah=a=>{let t=[],e={},s=[];a.forEach(a=>{t.includes(a.kategori)||t.push(a.kategori.replace(/\s/g,"_"))}),t.forEach(t=>{e[t]=a.filter(a=>a.kategori==t.replace(/_/g," "))});for(let a in e)e[a].forEach(a=>{s.push(a)});return s};$("#search-sampah").on("keyup",function(){let a="",t=[];t=""===$(this).val()?arrayJenisSampah:arrayJenisSampah.filter(a=>a.kategori.includes($(this).val().toLowerCase())||a.jenis.includes($(this).val().toLowerCase())),0==t.length?($("#list-sampah-notfound").removeClass("d-none"),$("#list-sampah-notfound #text-notfound").html("sampah tidak ditemukan")):($("#list-sampah-notfound").addClass("d-none"),$("#list-sampah-notfound #text-notfound").html(" "),t.forEach((t,e)=>{a+=`<tr class="text-xs">\n            <td class="align-middle text-center py-3">\n                <span class="font-weight-bold"> ${++e} </span>\n            </td>\n            <td class="align-middle text-center">\n                <span class="font-weight-bold"> ${t.kategori} </span>\n            </td>\n            <td class="align-middle text-center">\n            ${t.jenis}\n            </td>\n            <td class="align-middle text-center py-3">\n                <span class="font-weight-bold">Rp. ${modifUang(t.harga_pusat)} </span>\n            </td>\n            <td class="align-middle text-center py-3">\n                <span class="font-weight-bold">Rp. ${modifUang(t.harga)} </span>\n            </td>\n            <td class="align-middle text-center py-3">\n                <span class="font-weight-bold"> ${parseFloat(t.jumlah).toFixed(2)} </span>\n            </td>\n            <td class="align-middle text-center">\n                <a href="" class="badge badge-danger text-xxs pb-1 rounded-sm cursor-pointer" onclick="hapusSampah('${t.id}',event)" style="border-radius:4px;">hapus</a>\n                <a href="" class="badge badge-warning text-xxs pb-1 rounded-sm cursor-pointer" data-toggle="modal" data-target="#modalAddEditSampah" onclick="openModalAddEditSmp('editasampah','${t.id}')" style="border-radius:4px;">edit</a>\n            </td>\n        </tr>`})),$("#ket-total").html(t.length),$("#table-jenis-sampah tbody").html(a)});const clearInputForm=()=>{$("#formAddEditSampah .form-control").val("")},openModalAddEditSmp=(a,t=null)=>{let e="addsampah"==a?"tambah sampah":"edit sampah";if($("#modalAddEditSampah .modal-title").html(e),$("#formAddEditSampah .form-control").removeClass("is-invalid"),$("#formAddEditSampah .text-danger").html(""),"addsampah"==a)clearInputForm(),$("#formAddEditSampah #id").val(""),$("#kategori-sampah-wraper .kategori-list span").removeClass("d-none");else{let a=arrayJenisSampah.filter(a=>a.id==t);$("#formAddEditSampah #id").val(a[0].id),$("#formAddEditSampah #jenis").val(a[0].jenis),$("#formAddEditSampah #harga").val(a[0].harga),$("#formAddEditSampah #harga_pusat").val(a[0].harga_pusat),$("#formAddEditSampah #select-sampah-wraper").val(a[0].id_kategori),$(`#kategori-sampah-wraper .kategori-list span#${a[0].id_kategori}`).addClass("d-none")}};$("input#harga_pusat").on("keyup",function(a){$("input#harga").val(this.value-.1*this.value)});const crudSampah=async(a,t)=>{if(t.preventDefault(),doValidateAddSmp()){let t="",e="sampah berhasil diedit!",s=new FormData(a);$("#formAddEditSampah #btn-add-edit-sampah #text").addClass("d-none"),$("#formAddEditSampah #btn-add-edit-sampah #spinner").removeClass("d-none"),t=""!=$("#formAddEditSampah #id").val()?await httpRequestPut(`${APIURL}/sampah/editsampah`,s):await httpRequestPost(`${APIURL}/sampah/addsampah`,s),$("#formAddEditSampah #btn-add-edit-sampah #text").removeClass("d-none"),$("#formAddEditSampah #btn-add-edit-sampah #spinner").addClass("d-none"),201===t.status?(""==$("#formAddEditSampah #id").val()?(e="sampah berhasil ditambah!",clearInputForm()):($("#kategori-sampah-wraper .kategori-list span").removeClass("d-none"),$(`#kategori-sampah-wraper .kategori-list span#${s.get("id_kategori")}`).addClass("d-none")),getAllJenisSampah(),showAlert({message:`<strong>Success...</strong> ${e}`,autohide:!0,type:"success"})):400===t.status&&t.message.jenis&&($("#formAddEditSampah #jenis").addClass("is-invalid"),$("#formAddEditSampah #jenis-error").text(t.message.jenis))}},hapusSampah=(a,t)=>{t.preventDefault(),Swal.fire({input:"password",inputAttributes:{autocapitalize:"off"},html:"<h5 class='mb-4'>Password</h5>",showCancelButton:!0,confirmButtonText:"submit",showLoaderOnConfirm:!0,preConfirm:t=>{let e=new FormData;return e.append("hashedpass",PASSADMIN),e.append("password",t),axios.post(`${APIURL}/admin/confirmdelete`,e,{headers:{}}).then(t=>httpRequestDelete(`${APIURL}/sampah/deletesampah?id=${a}`).then(a=>{201==a.status?getAllJenisSampah():400==a.status&&showAlert({message:`<strong>Gagal . . .</strong> ${a.message}`,autohide:!0,type:"danger"})})).catch(a=>{404==a.response.status?Swal.showValidationMessage("password salah"):500==a.response.status&&Swal.showValidationMessage("terjadi kesalahan, coba sekali lagi")})},allowOutsideClick:()=>!Swal.isLoading()})},doValidateAddSmp=()=>{let a=!0;return $(".form-control").removeClass("is-invalid"),$(".text-danger").html(""),""==$("#formAddEditSampah #jenis").val()?($("#formAddEditSampah #jenis").addClass("is-invalid"),$("#formAddEditSampah #jenis-error").html("*jenis harus di isi"),a=!1):$("#formAddEditSampah #jenis").val().length>40&&($("#formAddEditSampah #jenis").addClass("is-invalid"),$("#formAddEditSampah #jenis-error").html("*maksimal 40 huruf"),a=!1),""==$("#formAddEditSampah #harga").val()?($("#formAddEditSampah #harga").addClass("is-invalid"),$("#formAddEditSampah #harga-error").html("*harga harus di isi"),a=!1):$("#formAddEditSampah #harga").val().length>11?($("#formAddEditSampah #harga").addClass("is-invalid"),$("#formAddEditSampah #harga-error").html("*maksimal 11 angka"),a=!1):/^\d+$/.test($("#formAddEditSampah #harga").val())||($("#formAddEditNasabah #harga").addClass("is-invalid"),$("#formAddEditNasabah #harga-error").html("*hanya boleh angka"),a=!1),""==$("#formAddEditSampah #harga_pusat").val()?($("#formAddEditSampah #harga_pusat").addClass("is-invalid"),$("#formAddEditSampah #harga_pusat-error").html("*harga pengepul harus di isi"),a=!1):$("#formAddEditSampah #harga_pusat").val().length>11?($("#formAddEditSampah #harga_pusat").addClass("is-invalid"),$("#formAddEditSampah #harga_pusat-error").html("*maksimal 11 angka"),a=!1):/^\d+$/.test($("#formAddEditSampah #harga_pusat").val())||($("#formAddEditNasabah #harga_pusat").addClass("is-invalid"),$("#formAddEditNasabah #harga_pusat-error").html("*hanya boleh angka"),a=!1),""==$("#formAddEditSampah #select-sampah-wraper").val()&&($("#formAddEditSampah #select-sampah-wraper").addClass("is-invalid"),$("#formAddEditSampah #select-sampah-wraper-error").html("*kategori harus di isi"),a=!1),a};