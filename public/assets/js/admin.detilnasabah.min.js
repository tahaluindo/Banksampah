function getCurrentDate(){let a=new Date((new Date).getTime()),t=a.toLocaleString("en-US",{day:"2-digit"}),e=a.toLocaleString("en-US",{month:"2-digit"}),r=a.toLocaleString("en-US",{year:"numeric"});return`${r}-${e}-${t}`}function getCurrentTime(){let a=new Date((new Date).getTime());return a.toLocaleString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})}const confirmModalClose=a=>{if(0==document.querySelector(`${a} #total-harga`).innerHTML)return $(a).modal("hide"),$(".modal-backdrop").remove(),0;Swal.fire({title:"Data akan terhapus <br> lanjut keluar?",showDenyButton:!0,confirmButtonText:"yes",denyButtonText:"no"}).then(t=>{t.isConfirmed?($(a).modal("hide"),$(".modal-backdrop").remove()):t.isDenied&&Swal.close()})},getSampahMasuk=async()=>{let a=await httpRequestGet(`${APIURL}/transaksi/sampahmasuk?idnasabah=${IDNASABAH}`);if(200===a.status){let t=a.data.data;for(const a in t)$(`#sampah-${a.replace(/\s/g,"-")}`).html(parseFloat(t[a].total).toFixed(1)+" Kg")}};getSampahMasuk();const openModalSampahMasuk=async a=>{$("#modalDetailSampah .modal-title").html(`kategori ${a}`),$("#detil-sampah-spinner").removeClass("d-none"),$("#detil-sampah-notfound").addClass("d-none"),$("#modalDetailSampah #table-jenis-wraper").html("");let t=await httpRequestGet(`${APIURL}/transaksi/sampahmasuk?kategori=${a}&idnasabah=${IDNASABAH}`);if($("#detil-sampah-spinner").addClass("d-none"),404===t.status)$("#detil-sampah-notfound").removeClass("d-none");else if(200===t.status){let a="",e=t.data.data;e.forEach((t,e)=>{a+=`<tr class="text-center">\n                <th scope="row">${++e}</th>\n                <td>${t.jenis}</td>\n                <td>${parseFloat(t.jumlah_kg).toFixed(2)} kg</td>\n            </tr>`}),$("#modalDetailSampah #table-jenis-wraper").html(`<table class="table table-striped">\n            <thead>\n                <tr class="text-center">\n                    <th scope="col">#</th>\n                    <th scope="col">Jenis sampah</th>\n                    <th scope="col">Jumlah</th>\n                </tr>\n            </thead>\n            <tbody>\n                ${a}\n            </tbody>\n        </table>`)}};let openModalFilterT=a=>{$("#formFilterTransaksi .modal-title").html(a);let t=a.toLowerCase().replace(" ","-"),e=$(`#btn-${t} #startdate`).html().split("/"),r=$(`#btn-${t} #enddate`).html().split("/");$("#formFilterTransaksi input[name=date-start]").val(`${e[2]}-${e[1]}-${e[0]}`),$("#formFilterTransaksi input[name=date-end]").val(`${r[2]}-${r[1]}-${r[0]}`)};$("#formFilterTransaksi input[type=date]").on("change",function(a){let t=$("#formFilterTransaksi input[name=date-start]").val(),e=$("#formFilterTransaksi input[name=date-end]").val();t&&e?($("#btn-filter-transaksi").attr("data-dismiss","modal"),$("#btn-filter-transaksi").attr("onclick","filterTransaksi(this,event);"),$("#formFilterTransaksi input[type=date]").removeClass("is-invalid")):($("#btn-filter-transaksi").removeAttr("data-dismiss"),$("#btn-filter-transaksi").removeAttr("onclick"),""==t&&$("#formFilterTransaksi input[name=date-start]").addClass("is-invalid"),""==e&&$("#formFilterTransaksi input[name=date-end]").addClass("is-invalid"))});let dateStartGrafik="",dateEndGrafik="",dateStartHistori="",dateEndHistori="",setCurrentStartDate=(a=null,t=!0)=>{let e="";e=a?new Date(a):new Date((new Date).getTime());let r=e.toLocaleString("en-US",{day:"2-digit"}),i=e.toLocaleString("en-US",{month:"2-digit"}),n=e.toLocaleString("en-US",{year:"numeric"}),s=new Date(e.getTime()-2592e6),o=s.toLocaleString("en-US",{day:"2-digit"}),l=s.toLocaleString("en-US",{month:"2-digit"}),d=s.toLocaleString("en-US",{year:"numeric"});t&&(dateStartGrafik=`${o}-${l}-${d}`,dateEndGrafik=`${r}-${i}-${n}`,$("#btn-filter-grafik #startdate").html(`${o}/${l}/${d}`),$("#btn-filter-grafik #enddate").html(`${r}/${i}/${n}`)),dateStartHistori=`${o}-${l}-${d}`,dateEndHistori=`${r}-${i}-${n}`,$("#btn-filter-histori #startdate").html(`${o}/${l}/${d}`),$("#btn-filter-histori #enddate").html(`${r}/${i}/${n}`)};setCurrentStartDate();const filterTransaksi=async a=>{let t=new FormData(a.parentElement.parentElement.parentElement),e=t.get("date-start").split("-"),r=t.get("date-end").split("-"),i=new Date(`${e[0]}/${e[1]}/${e[2]} 00:00:01`).getTime(),n=new Date(`${r[0]}/${r[1]}/${r[2]} 23:00:00`).getTime();if(parseInt(n)-parseInt(i)>2674799e3)return showAlert({message:"maksimal 31 hari",autohide:!0,type:"danger"}),0;"Filter Histori"==$("#formFilterTransaksi .modal-title").html()?(dateStartHistori=`${e[2]}-${e[1]}-${e[0]}`,dateEndHistori=`${r[2]}-${r[1]}-${r[0]}`,$("#btn-filter-histori #startdate").html(`${e[2]}/${e[1]}/${e[0]}`),$("#btn-filter-histori #enddate").html(`${r[2]}/${r[1]}/${r[0]}`),getHistoriTransaksi()):(dateStartGrafik=`${e[2]}-${e[1]}-${e[0]}`,dateEndGrafik=`${r[2]}-${r[1]}-${r[0]}`,$("#btn-filter-grafik #startdate").html(`${e[2]}/${e[1]}/${e[0]}`),$("#btn-filter-grafik #enddate").html(`${r[2]}/${r[1]}/${r[0]}`))};let chartGrafik="",grafikSetorYear=(new Date).getFullYear(),grafikSetorUrl=`${APIURL}/transaksi/grafikssampah?year=${grafikSetorYear}&tampilan=per-bulan&idnasabah=${IDNASABAH}`;const getDataGrafikSetor=async()=>{$("#spinner-wraper-grafik").removeClass("d-none");let a=await httpRequestGet(grafikSetorUrl);$("#spinner-wraper-grafik").addClass("d-none");let t="line",e=[""],r=[0];if(200===a.status){let t=a.data.data;for(const a in t)e.push(a),r.push(t[a].totSampahMasuk)}""!=chartGrafik&&chartGrafik.destroy();var i=document.getElementById("chart-line").getContext("2d");document.querySelector("#chart-line").style.width="100%",document.querySelector("#chart-line").style.height="300px",document.querySelector("#chart-line").style.maxHeight="300px";var n=i.createLinearGradient(0,230,0,50);n.addColorStop(1,"rgba(193,217,102,0.2)");var s=i.createLinearGradient(0,230,0,50);s.addColorStop(1,"rgba(193,217,102,0.2)");for(let a=e.length;a<10;a++)e.push(" ");"line"==t&&1==r.length&&(r=[],e.unshift("")),chartGrafik=new Chart(i,{type:t,data:{labels:e,datasets:[{label:"Kg",tension:.4,borderWidth:0,pointRadius:0,borderColor:"#c1d966",borderWidth:3,backgroundColor:n,fill:!0,data:r,maxBarThickness:6,minBarLength:6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{grid:{drawBorder:!1,display:!0,drawOnChartArea:!0,drawTicks:!1,borderDash:[5,5]},ticks:{display:!0,padding:10,color:"#b2b9bf",beginAtZero:!0,font:{size:11,family:"Open Sans",style:"normal",lineHeight:2}}},x:{grid:{drawBorder:!1,display:!1,drawOnChartArea:!1,drawTicks:!1,borderDash:[5,5]},ticks:{display:!0,color:"#b2b9bf",padding:0,font:{size:11,family:"Open Sans",style:"normal",lineHeight:2}}}}}})};getDataGrafikSetor(),$("select[name=tahun-grafik-setor]").on("input",function(){grafikSetorYear=$(this).val(),grafikSetorUrl=`${APIURL}/transaksi/grafikssampah?year=${grafikSetorYear}&tampilan=per-bulan&idnasabah=${IDNASABAH}`,getDataGrafikSetor()});const getHistoriTransaksi=async()=>{$("#spinner-wraper-histori").removeClass("d-none"),$("#transaksi-wraper-histori").addClass("d-none");let a=await httpRequestGet(`${APIURL}/transaksi/getdata?idnasabah=${IDNASABAH}&orderby=terbaru&start=${dateStartHistori}&end=${dateEndHistori}`);if($("#spinner-wraper-histori").addClass("d-none"),$("#transaksi-wraper-histori").removeClass("d-none"),404===a.status)$("#transaksi-wraper-histori").html("<h6 class='opacity-6'>belum ada transaksi</h6>");else if(200===a.status){let t="",e=a.data.data;e.forEach(a=>{let e="",r="",i=a.jenis_transaksi,n=a.jenis_saldo,s=new Date(1e3*parseInt(a.date)),o=s.toLocaleString("en-US",{day:"numeric"}),l=s.toLocaleString("en-US",{month:"long"}),d=s.toLocaleString("en-US",{year:"numeric"});"penyetoran sampah"==i?(e="text-success",r="+ Rp"+modifUang(a.total_uang_setor)):"konversi saldo"==i?(e="text-warning",r="Rp"+modifUang(kFormatter(a.total_pindah))+' <i class="fas fa-exchange-alt"></i> '+parseFloat(a.hasil_konversi).toFixed(4)+"g"):(e="text-danger",r="uang"==n?"- Rp"+modifUang(parseFloat(a.total_tarik).toFixed(0)):"- "+parseFloat(a.total_tarik).toFixed(4)+"g"),t+=`<li class="list-group-item border-0 ps-0 border-radius-lg">\n                <div class="d-flex justify-content-between">\n                    <div class="d-flex flex-column">\n                        <h6 class="mb-1 text-dark font-weight-bold text-sm">${l}, ${o}, ${d}</h6>\n                        <span class="text-xs">ID: ${a.id_transaksi}</span>\n                        <span class="${e} mt-2">${r}</span>\n                    </div>\n                    <div class="d-flex align-items-center text-sm">\n                        <a href='' class="btn btn-link text-dark text-sm mb-0 p-2 text-sm bg-info border-radius-sm" data-toggle="modal" data-target="#modalPrintTransaksi" onclick="getDetailTransaksiNasabah('${a.id_transaksi}');">\n                            <i class="fas fa-file-pdf text-xs text-white"></i>\n                        </a>\n                        <a href='' class="btn btn-link text-dark text-sm mb-0 p-2 ml-1 text-sm bg-warning border-radius-sm" data-toggle="modal" data-target="#modalEditSetor" data-backdrop="static" data-keyboard="false" onclick="openModalEditSetor('${a.id_transaksi}',event);">\n                            <i class="fas fa-edit text-xs text-white"></i>\n                        </a>\n                        <a href='' class="btn btn-link text-dark text-sm mb-0 p-2 ml-1 text-sm bg-danger border-radius-sm" onclick="deleteTransaksiNasabah('${a.id_transaksi}',event);">\n                            <i class="fas fa-trash text-xs text-white"></i>\n                        </a>\n                    </div>\n                </div>\n                <hr class="horizontal dark mt-2">\n            </li>`}),$("#transaksi-wraper-histori").html(`<ul class="list-group h-100 w-100" style="font-family: 'qc-medium';">\n            ${t}\n        </ul>`)}};getHistoriTransaksi();const getDetailTransaksiNasabah=async a=>{$("#detil-transaksi-body").html(" "),$("#detil-transaksi-spinner").removeClass("d-none");let t=await httpRequestGet(`${APIURL}/transaksi/getdata?id_transaksi=${a}`);if(200===t.status){$("#detil-transaksi-spinner").addClass("d-none");let a=new Date(1e3*parseInt(t.data.data.date)),e=a.toLocaleString("en-US",{day:"numeric"}),r=a.toLocaleString("en-US",{month:"numeric"}),i=a.toLocaleString("en-US",{year:"numeric"}),n=a.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"});if($("#detil-transaksi-date").html(`${e}/${r}/${i}&nbsp;&nbsp;&nbsp;${n}`),$("#detil-transaksi-nama").html(t.data.data.nama_lengkap),$("#detil-transaksi-idnasabah").html(t.data.data.id_user),$("#detil-transaksi-idtransaksi").html(t.data.data.id_transaksi),$("#detil-transaksi-type").html(t.data.data.jenis_transaksi),$("#btn-cetak-transaksi").attr("href",`${BASEURL}/transaksi/cetaktransaksi/${t.data.data.id_transaksi}`),"penarikan saldo"==t.data.data.jenis_transaksi){let a=t.data.data.jenis_saldo,e="uang"==a?"Rp "+modifUang(parseFloat(t.data.data.jumlah_tarik).toFixed(0)):parseFloat(t.data.data.jumlah_tarik).toFixed(4)+" gram";$("#detil-transaksi-body").html(`<div class="p-4 bg-secondary border-radius-sm">\n                <table>\n                    <tr class="text-dark">\n                        <td><h4>Jenis saldo&nbsp;</h4></td>\n                        <td>\n                            <h4>\n                            : &nbsp;&nbsp;${"uang"==a?a:"emas "+a}\n                            </h4>\n                        </td>\n                    </tr>\n                    <tr class="text-dark">\n                        <td><h4>Jumlah</h4></td>\n                        <td><h4>: &nbsp;&nbsp;${e}</h4></td>\n                    </tr>\n                </table>\n            </div>`)}if("konversi saldo"==t.data.data.jenis_transaksi&&$("#detil-transaksi-body").html(`<div class="p-4 bg-secondary border-radius-sm">\n            <table>\n                <tr class="text-dark">\n                    <td>Jumlah</td>\n                    <td>: &nbsp;&nbsp;Rp ${modifUang(t.data.data.jumlah)}</td>\n                </tr>\n                <tr class="text-dark">\n                    <td>Harga emas</td>\n                    <td>: &nbsp;&nbsp;Rp ${modifUang(t.data.data.harga_emas)}</td>\n                </tr>\n                <tr class="text-dark">\n                    <td>Hasil konversi&nbsp;</td>\n                    <td>\n                        : &nbsp;&nbsp;${parseFloat(t.data.data.hasil_konversi).toFixed(4)} g\n                    </td>\n                </tr>\n            </table>\n            </div>`),"penyetoran sampah"==t.data.data.jenis_transaksi){let a=0,e=0,r="",i=t.data.data.barang;i.forEach((t,i)=>{a+=parseFloat(t.jumlah_rp),e+=parseFloat(t.jumlah_kg),r+=`<tr class="text-center">\n                    <th scope="row">${++i}</th>\n                    <td>${t.jenis}</td>\n                    <td>${parseFloat(t.jumlah_kg).toFixed(2)} kg</td>\n                    <td class="text-right">${modifUang(t.jumlah_rp)}</td>\n                </tr>`}),$("#detil-transaksi-body").html(`<table class="table table-striped">\n                <thead>\n                    <tr>\n                        <th scope="col">#</th>\n                        <th scope="col">Jenis sampah</th>\n                        <th scope="col">Jumlah</th>\n                        <th scope="col">Harga</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${r}\n                    <tr>\n                        <th class="text-center" colspan='2'>Total</th>\n                        <td class="text-center">${parseFloat(e).toFixed(2)}</td>\n                        <td class="text-center">${modifUang(a.toString())}</td>\n                    </tr>\n                </tbody>\n            </table>`)}}};let dataSaldo="";const getSaldoNasabah=async()=>{$("#formPindahSaldo #maximal-saldo").html("_ _ _ _"),$("#saldo-uang").html("_ _"),$("#saldo-emas").html("_ _");let a=await httpRequestGet(`${APIURL}/transaksi/getsaldo?idnasabah=${IDNASABAH}`);200===a.status&&(dataSaldo=a.data.data,$("#formPindahSaldo #maximal-saldo").html(`${modifUang(dataSaldo.uang)}`),$("#saldo-uang").html(modifUang(dataSaldo.uang)),$("#saldo-emas").html(parseFloat(dataSaldo.emas||0).toFixed(4)))};getSaldoNasabah();const getDataProfileNasabah=async()=>{let a=await httpRequestGet(`${APIURL}/admin/getnasabah?id=${IDNASABAH}`);if(404==a.status)Swal.fire({icon:"error",title:"<strong>NOT FOUND</strong>",text:`nasabah dengan id ${IDNASABAH} tidak ditemukan!`,showCancelButton:!1,confirmButtonText:"ok"}).then(()=>{window.location.replace(`${BASEURL}/admin/listnasabah`)});else if(200===a.status){let t=a.data.data[0],e=new Date(1e3*parseInt(t.created_at));$("#navbar-namalengkap").html(t.nama_lengkap),$("#card-id").html(`${t.id.slice(0,5)}&nbsp;&nbsp;&nbsp;${t.id.slice(5,9)}&nbsp;&nbsp;&nbsp;${t.id.slice(9,99999999)}`),$("#card-username").html(t.username),$("#card-date").html(`${e.toLocaleString("en-US",{day:"numeric"})}/${e.toLocaleString("en-US",{month:"numeric"})}/${e.toLocaleString("en-US",{year:"numeric"})}`),$("#personal-info #email").html(t.email),$("#personal-info #nama-lengkap").html(t.nama_lengkap),$("#personal-info #username").html(t.username),$("#personal-info #tgl-lahir").html(t.tgl_lahir),$("#personal-info #kelamin").html(t.kelamin),$("#personal-info #alamat").html(t.alamat),$("#personal-info #notelp").html(t.notelp),$("#personal-info #nik").html(t.nik)}};getDataProfileNasabah();const openModalTransaksi=a=>{$(".form-check-input").removeClass("is-invalid"),$(".form-check-input").prop("checked",!1),$(".form-control").removeClass("is-invalid"),$(".text-danger").html(""),$(".form-control").val(""),$("#formTarikSaldo #maximal-saldo").html(""),"setor sampah"==a?($("#formSetorSampah .barisSetorSampah").remove(),tambahBaris(),countTotalHarga()):"pindah saldo"==a&&$("#formPindahSaldo #maximal-saldo").html(`${modifUang(dataSaldo.uang)}`),$(".modalTransaksi input[type=date]").val(getCurrentDate()),$(".modalTransaksi input[type=time]").val(getCurrentTime())};let arrayJenisSampah=[];const getAllJenisSampah=async()=>{let a=await httpRequestGet(`${APIURL}/sampah/getsampah`);200===a.status&&(arrayJenisSampah=a.data.data),tambahBaris()};getAllJenisSampah();const tambahBaris=(a=!1)=>{a&&a.preventDefault();let t=[],e='<option data-kategori="" selected>-- kategori sampah  --</option>';0!==arrayJenisSampah.length&&arrayJenisSampah.forEach(a=>{t.includes(a.kategori)||(t.push(a.kategori),e+=`<option data-kategori="${a.kategori}">${a.kategori}</option>`)});let r=$(".barisSetorSampah").size(),i=` <td class="py-2" style="border-right: 0.5px solid #E9ECEF;">\n        <span class="w-100 btn btn-danger d-flex justify-content-center align-items-center border-radius-sm" style="height: 38px;margin: 0;" onclick="hapusBaris(this);">\n            <i class="fas fa-times text-white"></i>\n        </span>\n    </td>\n    <td class="py-2" style="border-right: 0.5px solid #E9ECEF;">\n        <span class="nomor w-100 d-flex justify-content-center align-items-center border-radius-sm" style="height: 38px;margin: 0;">\n            ${$(".barisSetorSampah").size()+1}\n        </span>\n    </td>\n    <td class="py-2" style="border-right: 0.5px solid #E9ECEF;">\n        <select id="kategori-berita-wraper" class="inputJenisSampah form-control form-control-sm py-1 pl-2 border-radius-sm" style="min-height: 38px" onchange="insertJenisSampah(this,event);">\n            ${e}\n        </select>\n    </td>\n    <td class="py-2" style="border-right: 0.5px solid #E9ECEF;">\n        <select id="kategori-berita-wraper" class="inputJenisSampah form-control form-control-sm py-1 pl-2 border-radius-sm" name="transaksi[slot${r+1}][id_sampah]" style="min-height: 38px" onchange="getHargaInOption(this,event);" disabled>\n            <option>-- jenis sampah  --</option>\n        </select>\n    </td>\n    <td class="py-2" style="border-right: 0.5px solid #E9ECEF;">\n        <input type="text" class="inputJumlahSampah form-control form-control-sm pl-2 border-radius-sm" value="0" name="transaksi[slot${r+1}][jumlah]" style="min-height: 38px" onkeyup="countHargaXjumlah(this);" autocomplete="off">\n    </td>\n    <td class="py-2">\n        <input type="text" class="inputHargaSampah form-control form-control-sm pl-2 border-radius-sm" style="min-height: 38px" data-harga="0" value="0" disabled>\n    </td>`,n=document.createElement("tr");n.classList.add("barisSetorSampah"),n.innerHTML=i,document.querySelector("#table-setor-sampah tbody").insertBefore(n,document.querySelector("#formSetorSampah #special-tr"))},hapusBaris=a=>{a.parentElement.parentElement.remove(),$("#formSetorSampah .barisSetorSampah").each(function(a,t){t.querySelector(".nomor").innerHTML=a+1}),countTotalHarga()},insertJenisSampah=(a,t)=>{var e=t.target.options[t.target.selectedIndex].dataset.kategori;let r="<option value='' data-harga='' selected>-- jenis sampah --</option>",i=arrayJenisSampah.sort((a,t)=>a.jenis.localeCompare(t.jenis));i.forEach(a=>{a.kategori==e&&(r+=`<option value='${a.id}' data-harga='${a.harga}'>${a.jenis}</option>`)});let n=a.parentElement.nextElementSibling.children[0],s=a.parentElement.nextElementSibling.nextElementSibling.children[0],o=a.parentElement.nextElementSibling.nextElementSibling.nextElementSibling.children[0];n.innerHTML=r,s.value=0,o.value=0,o.setAttribute("data-harga",0),countTotalHarga(),countTotalHargaEditSetor(),""!=e?n.removeAttribute("disabled"):n.setAttribute("disabled",!0)},getHargaInOption=(a,t)=>{var e=t.target.options[t.target.selectedIndex].dataset.harga;let r=a.parentElement.nextElementSibling.children[0];r.value=1;let i=a.parentElement.nextElementSibling.nextElementSibling.children[0];i.value=e,i.setAttribute("data-harga",e),countTotalHarga()},countHargaXjumlah=a=>{var t=a.value;let e=a.parentElement.previousElementSibling.children[0];if(""!==e.value&&""!==t){let e=a.parentElement.nextElementSibling.children[0],r=e.getAttribute("data-harga");e.value=parseFloat(parseFloat(t)*parseInt(r)).toFixed(2),countTotalHarga()}},countTotalHarga=()=>{let a=0;$("#formSetorSampah .inputHargaSampah").each(function(){a+=parseFloat($(this).val())}),$("#formSetorSampah #special-tr #total-harga").html(modifUang(a.toString()))},validateSetorSampah=()=>{let a=!0,t="";return $("#formSetorSampah .form-control").removeClass("is-invalid"),$("#formSetorSampah .text-danger").html(""),""==$("#formSetorSampah #date").val()&&($("#formSetorSampah #date").addClass("is-invalid"),$("#formSetorSampah #date-error").html("*waktu harus di isi"),a=!1),""==$("#formSetorSampah #time").val()&&($("#formSetorSampah #time").addClass("is-invalid"),$("#formSetorSampah #date-error").html("*waktu harus di isi"),a=!1),$("#formSetorSampah .inputJenisSampah").each(function(){(""==$(this).val()||$(this).attr("disabled"))&&($(this).addClass("is-invalid"),a=!1,t="input tidak boleh kosong!")}),$("#formSetorSampah .inputJumlahSampah").each(function(){""==$(this).val()&&($(this).addClass("is-invalid"),a=!1,t="input tidak boleh kosong!"),/[^0-9\.]/g.test($(this).val().replace(/ /g,""))&&($(this).addClass("is-invalid"),a=!1,t="jumlah hanya boleh berupa angka positif dan titik!")}),0==a&&""!==t&&showAlert({message:`<strong>${t}</strong>`,autohide:!0,type:"danger"}),a},validatePindahSaldo=()=>{let a=!0;return $("#formPindahSaldo .form-check-input").removeClass("is-invalid"),$("#formPindahSaldo .form-control").removeClass("is-invalid"),$("#formPindahSaldo .text-danger").html(""),""==$("#formPindahSaldo #date").val()&&($("#formPindahSaldo #date").addClass("is-invalid"),$("#formPindahSaldo #date-error").html("*tanggal harus di isi"),a=!1),""==$("#formPindahSaldo #time").val()&&($("#formPindahSaldo #time").addClass("is-invalid"),$("#formPindahSaldo #date-error").html("*waktu harus di isi"),a=!1),""==$("#formPindahSaldo #harga_emas").val()?($("#formPindahSaldo #harga_emas").addClass("is-invalid"),$("#formPindahSaldo #harga_emas-error").html("*harga emas harus di isi"),a=!1):/[^0-9\.]/g.test($("#formPindahSaldo #harga_emas").val().replace(/ /g,""))&&($("#formPindahSaldo #harga_emas").addClass("is-invalid"),$("#formPindahSaldo #harga_emas-error").html("*hanya boleh berupa angka positif dan titik!"),a=!1),""==$("#formPindahSaldo #jumlah").val()?($("#formPindahSaldo #jumlah").addClass("is-invalid"),$("#formPindahSaldo #jumlah-error").html("*jumlah saldo harus di isi"),a=!1):/[^0-9\.]/g.test($("#formPindahSaldo #jumlah").val().replace(/ /g,""))?($("#formPindahSaldo #jumlah").addClass("is-invalid"),$("#formPindahSaldo #jumlah-error").html("*hanya boleh berupa angka positif dan titik!"),a=!1):parseFloat($("#formPindahSaldo #jumlah").val())<1e4&&($("#formPindahSaldo #jumlah").addClass("is-invalid"),$("#formPindahSaldo #jumlah-error").html("*minimal Rp.10,000"),a=!1),a};$("#formTarikSaldo input[name=jenis_saldo]").on("click",function(){"uang"==$(this).attr("value")?($("#formTarikSaldo #maximal-saldo").html(`Rp ${modifUang(dataSaldo.uang)}`),$("#formTarikSaldo #jenis-emas").attr("disabled",!0),$("#formTarikSaldo #jenis-emas").val("")):($("#formTarikSaldo #maximal-saldo").html(`${dataSaldo.emas}`),$("#formTarikSaldo #jenis-emas").removeAttr("disabled"))});const validateTarikSaldo=()=>{let a=!0,t=new FormData(document.querySelector("#formTarikSaldo"));return $("#formTarikSaldo .form-check-input").removeClass("is-invalid"),$("#formTarikSaldo .form-control").removeClass("is-invalid"),$("#formTarikSaldo .text-danger").html(""),""==$("#formTarikSaldo #date").val()&&($("#formTarikSaldo #date").addClass("is-invalid"),$("#formTarikSaldo #date-error").html("*tanggal harus di isi"),a=!1),""==$("#formTarikSaldo #time").val()&&($("#formTarikSaldo #time").addClass("is-invalid"),$("#formTarikSaldo #date-error").html("*waktu harus di isi"),a=!1),null==t.get("jenis_saldo")&&($("#formTarikSaldo .form-check-input").addClass("is-invalid"),a=!1),"emas"==t.get("jenis_saldo")&&""==t.get("jenis_emas")&&($("#formTarikSaldo #jenis-emas").addClass("is-invalid"),a=!1),""==$("#formTarikSaldo #jumlah").val()?($("#formTarikSaldo #jumlah").addClass("is-invalid"),$("#formTarikSaldo #jumlah-error").html("*jumlah saldo harus di isi"),a=!1):/[^0-9\.]/g.test($("#formTarikSaldo #jumlah").val().replace(/ /g,""))&&($("#formTarikSaldo #jumlah").addClass("is-invalid"),$("#formTarikSaldo #jumlah-error").html("*hanya boleh berupa angka positif dan titik!"),a=!1),a},doTransaksi=async(a,t,e)=>{t.preventDefault();let r="",i=a.parentElement.parentElement.parentElement,n="";if("setorsampah"==e?(r=validateSetorSampah,n="setor sampah"):"pindahsaldo"==e?(r=validatePindahSaldo,n="pindah saldo"):"tariksaldo"==e&&(r=validateTarikSaldo,n="tarik saldo"),r()){let a=new FormData(i),t=a.get("date").split("-"),r=a.get("time");a.set("date",`${t[2]}-${t[1]}-${t[0]} ${r}`),"tariksaldo"==e&&""!==$("#formTarikSaldo #jenis-emas").val()&&a.set("jenis_saldo",$("#formTarikSaldo #jenis-emas").val()),showLoadingSpinner(),httpResponse=await httpRequestPost(`${APIURL}/transaksi/${e}`,a),hideLoadingSpinner(),201===httpResponse.status?($(".form-control").val(""),$(".form-check-input").prop("checked",!1),$("input[type=date]").val(getCurrentDate()),$("input[type=time]").val(getCurrentTime()),updateTableAndGrafik(`${t[0]}/${t[1]}/31`,e),getSaldoNasabah(),"setorsampah"==e?($(".barisSetorSampah").remove(),tambahBaris(),countTotalHarga(),getSampahMasuk()):"tariksaldo"==e&&($("#formTarikSaldo #maximal-saldo").html(""),$("#formTarikSaldo #jenis-emas").attr("disabled",!0),$("#formTarikSaldo #jenis-emas").val("")),showAlert({message:`<strong>Success...</strong> ${n} berhasil!`,autohide:!0,type:"success"})):400===httpResponse.status&&httpResponse.message.jumlah&&("pindahsaldo"==e?($("#formPindahSaldo #jumlah").addClass("is-invalid"),$("#formPindahSaldo #jumlah-error").html(`*${httpResponse.message.jumlah}`)):($("#formTarikSaldo #jumlah").addClass("is-invalid"),$("#formTarikSaldo #jumlah-error").html(`*${httpResponse.message.jumlah}`)))}},openModalEditSetor=async a=>{$("#formEditSetor .form-check-input").removeClass("is-invalid"),$("#formEditSetor .form-check-input").prop("checked",!1),$("#formEditSetor .form-control").removeClass("is-invalid"),$("#formEditSetor .text-danger").html(""),$("#formEditSetor .form-control").val(""),$("#formEditSetor .barisEditSetor").remove(),$("#formEditSetor #spinner").removeClass("d-none");let t=await httpRequestGet(`${APIURL}/transaksi/getdata?id_transaksi=${a}`);if(200===t.status){$("#formEditSetor #spinner").addClass("d-none");let a=new Date(1e3*parseInt(t.data.data.date)),e=a.toLocaleString("en-US",{day:"2-digit"}),r=a.toLocaleString("en-US",{month:"2-digit"}),i=a.toLocaleString("en-US",{year:"numeric"}),n=a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),s=t.data.data.barang;console.log(`${i}-${r}-${e}`),$("#formEditSetor input[name=id_nasabah]").val(t.data.data.id_user),$("#formEditSetor input[name=id_transaksi]").val(t.data.data.id_transaksi),$("#formEditSetor input[name=date]").val(`${i}-${r}-${e}`),$("#formEditSetor input[name=time]").val(n),s.forEach(a=>{tambahBarisEditSetor(!1,a)}),countTotalHargaEditSetor()}},hapusBarisEditSetor=a=>{a.parentElement.parentElement.remove(),$("#formEditSetor .barisEditSetor").each(function(a,t){t.querySelector(".nomor").innerHTML=a+1}),countTotalHargaEditSetor()},tambahBarisEditSetor=(a=!1,t=!1)=>{a&&a.preventDefault();let e=[],r='<option data-kategori="" selected>-- kategori sampah  --</option>';0!==arrayJenisSampah.length&&arrayJenisSampah.forEach(a=>{e.includes(a.kategori)||(e.push(a.kategori),r+=`<option data-kategori="${a.kategori}"  ${t.kategori==a.kategori?"selected":""}>${a.kategori}</option>`)});let i="<option value='' data-harga='' selected>-- jenis sampah --</option>";if(0!=t){let a=arrayJenisSampah.sort((a,t)=>a.jenis.localeCompare(t.jenis));a.forEach(a=>{a.kategori==t.kategori&&(i+=`<option value='${a.id}' data-harga='${a.harga}' ${t.jenis==a.jenis?"selected":""}>${a.jenis}</option>`)})}let n=$(".barisEditSetor").size(),s=` <td class="py-2" style="border-right: 0.5px solid #E9ECEF;">\n        <span class="w-100 btn btn-danger d-flex justify-content-center align-items-center border-radius-sm" style="height: 38px;margin: 0;" onclick="hapusBarisEditSetor(this);">\n            <i class="fas fa-times text-white"></i>\n        </span>\n    </td>\n    <td class="py-2" style="border-right: 0.5px solid #E9ECEF;">\n        <span class="nomor w-100 d-flex justify-content-center align-items-center border-radius-sm" style="height: 38px;margin: 0;">\n            ${$(".barisEditSetor").size()+1}\n        </span>\n    </td>\n    <td class="py-2" style="border-right: 0.5px solid #E9ECEF;">\n        <select id="kategori-berita-wraper" class="inputJenisSampah form-control form-control-sm py-1 pl-2 border-radius-sm" style="min-height: 38px" onchange="insertJenisSampah(this,event);">\n            ${r}\n        </select>\n    </td>\n    <td class="py-2" style="border-right: 0.5px solid #E9ECEF;">\n        <select id="kategori-berita-wraper" class="inputJenisSampah form-control form-control-sm py-1 pl-2 border-radius-sm" name="transaksi[slot${n+1}][id_sampah]" style="min-height: 38px" onchange="getHargaInOptionEditSetor(this,event);" ${0!=t?"":"disabled"}>\n            ${i}\n        </select>\n    </td>\n    <td class="py-2" style="border-right: 0.5px solid #E9ECEF;">\n        <input type="text" class="inputJumlahSampah form-control form-control-sm pl-2 border-radius-sm" value="${0!=t?t.jumlah_kg:0}" name="transaksi[slot${n+1}][jumlah]" style="min-height: 38px" onkeyup="countHargaXjumlahEditSetor(this);" autocomplete="off">\n    </td>\n    <td class="py-2">\n        <input type="text" class="inputHargaSampah form-control form-control-sm pl-2 border-radius-sm" style="min-height: 38px" data-harga="${0!=t?t.jumlah_rp/t.jumlah_kg:0}"  value="${0!=t?t.jumlah_rp:0}" disabled>\n    </td>`,o=document.createElement("tr");o.classList.add("barisEditSetor"),o.innerHTML=s,document.querySelector("#table-edit-setor tbody").insertBefore(o,document.querySelector("#table-edit-setor #special-tr"))},getHargaInOptionEditSetor=(a,t)=>{var e=t.target.options[t.target.selectedIndex].dataset.harga;let r=a.parentElement.nextElementSibling.children[0];r.value=1;let i=a.parentElement.nextElementSibling.nextElementSibling.children[0];i.value=e,i.setAttribute("data-harga",e),countTotalHargaEditSetor()},countHargaXjumlahEditSetor=a=>{var t=""==a.value?0:a.value;let e=a.parentElement.previousElementSibling.children[0];if(""!==e.value&&""!==t){let e=a.parentElement.nextElementSibling.children[0],r=e.getAttribute("data-harga");e.value=parseFloat(parseFloat(t)*parseInt(r)).toFixed(2),countTotalHargaEditSetor()}},countTotalHargaEditSetor=()=>{let a=0;$("#formEditSetor .inputHargaSampah").each(function(){a+=parseFloat($(this).val())}),$("#formEditSetor #special-tr #total-harga").html(modifUang(a.toString()))},validateEditSetor=()=>{let a=!0,t="";return $("#formEditSetor .form-control").removeClass("is-invalid"),$("#formEditSetor .text-danger").html(""),""==$("#formEditSetor #date").val()&&($("#formEditSetor #date").addClass("is-invalid"),$("#formEditSetor #date-error").html("*waktu harus di isi"),a=!1),""==$("#formEditSetor #time").val()&&($("#formEditSetor #time").addClass("is-invalid"),$("#formEditSetor #date-error").html("*waktu harus di isi"),a=!1),$("#formEditSetor .inputJenisSampah").each(function(){(""==$(this).val()||$(this).attr("disabled"))&&($(this).addClass("is-invalid"),a=!1,t="input tidak boleh kosong!")}),$("#formEditSetor .inputJumlahSampah").each(function(){""==$(this).val()&&($(this).addClass("is-invalid"),a=!1,t="input tidak boleh kosong!"),/[^0-9\.]/g.test($(this).val().replace(/ /g,""))&&($(this).addClass("is-invalid"),a=!1,t="jumlah hanya boleh berupa angka positif dan titik!")}),0==a&&""!==t&&showAlert({message:`<strong>${t}</strong>`,autohide:!0,type:"danger"}),a},doEditSetor=async(a,t)=>{t.preventDefault();let e=a.parentElement.parentElement.parentElement;if(validateEditSetor()){let a=new FormData(e),t=a.get("date").split("-"),r=a.get("time")
;a.set("date",`${t[2]}-${t[1]}-${t[0]} ${r}`),showLoadingSpinner(),httpResponse=await httpRequestPost(`${APIURL}/transaksi/editsetorsampah`,a),hideLoadingSpinner(),201===httpResponse.status&&(updateTableAndGrafik(`${t[0]}/${t[1]}/31`,"setorsampah"),getSaldoNasabah(),showAlert({message:"<strong>Success...</strong> edit setor berhasil!",autohide:!0,type:"success"}))}},deleteTransaksiNasabah=(a,t)=>{t.preventDefault(),Swal.fire({title:"ANDA YAKIN?",text:"Data akan terhapus permanen",icon:"warning",showCancelButton:!0,confirmButtonText:"iya"}).then(t=>{t.isConfirmed&&Swal.fire({input:"password",inputAttributes:{autocapitalize:"off"},html:"<h5 class='mb-4'>Password</h5>",showCancelButton:!0,confirmButtonText:"submit",showLoaderOnConfirm:!0,preConfirm:t=>{let e=new FormData;return e.append("hashedpass",PASSADMIN),e.append("password",t),axios.post(`${APIURL}/admin/confirmdelete`,e,{headers:{}}).then(t=>httpRequestDelete(`${APIURL}/transaksi/deletedata?id=${a}`).then(t=>{201==t.status&&(getSampahMasuk(),getSaldoNasabah(),a.includes("TSS")&&(dateStartGrafik=dateStartHistori,dateEndGrafik=dateEndHistori,$("#btn-filter-grafik #startdate").html($("#btn-filter-histori #startdate").html()),$("#btn-filter-grafik #enddate").html($("#btn-filter-histori #enddate").html())),getHistoriTransaksi())})).catch(a=>{404==a.response.status?Swal.showValidationMessage("password salah"):500==a.response.status&&Swal.showValidationMessage("terjadi kesalahan, coba sekali lagi")})},allowOutsideClick:()=>!Swal.isLoading()})})};$("#formRekapTransaksi select[name=jenis]").on("change",function(a){let t=$(this).val();"buku-tabungan"==t?($("#formRekapTransaksi .input-start-date").addClass("d-none"),$("#formRekapTransaksi .input-end-date").addClass("d-none")):($("#formRekapTransaksi .input-start-date").removeClass("d-none"),$("#formRekapTransaksi .input-end-date").removeClass("d-none"))}),$("#formRekapTransaksi input[type=date]").on("change",function(a){let t=$("#formRekapTransaksi input[name=date-start]").val(),e=$("#formRekapTransaksi input[name=date-end]").val();t&&e?($("#btn-filter-transaksi").attr("data-dismiss","modal"),$("#btn-filter-transaksi").attr("disabled",!0),$("#formRekapTransaksi input[type=date]").removeClass("is-invalid")):($("#btn-filter-transaksi").removeAttr("data-dismiss"),$("#btn-filter-transaksi").removeAttr("disabled"),""==t&&$("#formRekapTransaksi input[name=date-start]").addClass("is-invalid"),""==e&&$("#formRekapTransaksi input[name=date-end]").addClass("is-invalid"))});const cetakRekap=()=>{let a=new FormData(document.querySelector("#formRekapTransaksi")),t=a.get("jenis");if("buku-tabungan"!=t&&(""==a.get("date-start")||""==a.get("date-end")))return showAlert({message:"<strong>Perhatian...</strong> isi waktu mulai dan waktu berakhir!",autohide:!0,type:"warning"}),0;let e=a.get("date-start").split("-"),r=a.get("date-end").split("-"),i=`${e[2]}-${e[1]}-${e[0]}`,n=`${r[2]}-${r[1]}-${r[0]}`,s=`${BASEURL}/transaksi/cetakrekap/${t}?start=${i}&end=${n}&idnasabah=${IDNASABAH}`;window.open(s,"_blank")},updateTableAndGrafik=(a,t)=>{let e=new Date(`${a} 00:00:01`).getTime(),r="setorsampah"==t;setCurrentStartDate(e,r),getHistoriTransaksi()};