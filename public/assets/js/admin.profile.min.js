function validateFormEditProfile(e){let a=!0,t=e.get("kelamin");return $("#formEditProfile .form-control").removeClass("is-invalid"),$("#formEditProfile .form-check-input").removeClass("is-invalid"),$("#formEditProfile .text-danger").html(""),""==$("#nama-edit").val()?($("#nama-edit").addClass("is-invalid"),$("#nama-edit-error").html("*nama lengkap harus di isi"),a=!1):$("#nama-edit").val().length>40&&($("#nama-edit").addClass("is-invalid"),$("#nama-edit-error").html("*maksimal 40 huruf"),a=!1),""==$("#username-edit").val()?($("#username-edit").addClass("is-invalid"),$("#username-edit-error").html("*username harus di isi"),a=!1):$("#username-edit").val().length<8||$("#username-edit").val().length>20?($("#username-edit").addClass("is-invalid"),$("#username-edit-error").html("*minimal 8 huruf dan maksimal 20 huruf"),a=!1):/\s/.test($("#username-edit").val())&&($("#username-edit").addClass("is-invalid"),$("#username-edit-error").html("*tidak boleh ada spasi"),a=!1),""==$("#tgllahir-edit").val()&&($("#tgllahir-edit").addClass("is-invalid"),$("#tgllahir-edit-error").html("*tgl lahir harus di isi"),a=!1),null==t&&($("#formEditProfile .form-check-input").addClass("is-invalid"),a=!1),""==$("#alamat-edit").val()?($("#alamat-edit").addClass("is-invalid"),$("#alamat-edit-error").html("*alamat harus di isi"),a=!1):$("#alamat-edit").val().length>255&&($("#alamat-edit").addClass("is-invalid"),$("#alamat-edit-error").html("*maksimal 255 huruf"),a=!1),""==$("#notelp-edit").val()?($("#notelp-edit").addClass("is-invalid"),$("#notelp-edit-error").html("*no.telp harus di isi"),a=!1):$("#notelp-edit").val().length>14?($("#notelp-edit").addClass("is-invalid"),$("#notelp-edit-error").html("*maksimal 14 huruf"),a=!1):/^\d+$/.test($("#notelp-edit").val())||($("#notelp-edit").addClass("is-invalid"),$("#notelp-edit-error").html("*hanya boleh angka"),a=!1),""!==$("#newpass-edit").val()&&($("#newpass-edit").val().length<8||$("#newpass-edit").val().length>20?($("#newpass-edit").addClass("is-invalid"),$("#newpass-edit-error").html("*minimal 8 huruf dan maksimal 20 huruf"),a=!1):/\s/.test($("#newpass-edit").val())&&($("#newpass-edit").addClass("is-invalid"),$("#newpass-edit-error").html("*tidak boleh ada spasi"),a=!1),""==$("#oldpass-edit").val()&&($("#oldpass-edit").addClass("is-invalid"),$("#oldpass-edit-error").html("*password lama harus di isi"),a=!1)),a}function doLogout(){showLoadingSpinner(),axios.delete(`${APIURL}/admin/logout`,{headers:{token:TOKEN}}).then(()=>{hideLoadingSpinner(),document.cookie="token=null; path=/;",window.location.replace(`${BASEURL}/login/admin`)}).catch(e=>{hideLoadingSpinner(),document.cookie="token=null; path=/;",window.location.replace(`${BASEURL}/login/admin`)})}const getDataProfile=async()=>{let e=await httpRequestGet(`${APIURL}/admin/getprofile`);200===e.status&&(dataAdmin=e.data.data,updatePersonalInfo(dataAdmin))};getDataProfile();const updatePersonalInfo=e=>{$("#profile-spinner").addClass("d-none"),$("#idadmin").html(e.id),$("#nama-lengkap").html(e.nama_lengkap),$("#username").html(e.username),$("#tgl-lahir").html(e.tgl_lahir),$("#kelamin").html(e.kelamin),$("#alamat").html(e.alamat),$("#notelp").html(e.notelp)};$("#btn-edit-profile").on("click",function(e){e.preventDefault(),$("#formEditProfile .form-control").removeClass("is-invalid"),$("#formEditProfile .form-check-input").removeClass("is-invalid"),$("#formEditProfile .text-danger").html("");for(const e in dataAdmin)$(`#formEditProfile input[name=${e}]`).val(dataAdmin[e]);let a=dataAdmin.tgl_lahir.split("-");$("#formEditProfile input[name=tgl_lahir]").val(`${a[2]}-${a[1]}-${a[0]}`),$(`#formEditProfile input#kelamin-${dataAdmin.kelamin}`).prop("checked",!0),$("#newpass-edit").val(""),$("#oldpass-edit").val("")}),$("#formEditProfile .form-check-input").on("click",function(e){$("#formEditProfile input[name=kelamin]").val($(this).val()),$("#formEditProfile .form-check-input").prop("checked",!1),$(this).prop("checked",!0)}),$("#formEditProfile").on("submit",function(e){e.preventDefault();let a=!1,t=new FormData(e.target);if(validateFormEditProfile(t)){let e=t.get("tgl_lahir").split("-");t.set("tgl_lahir",`${e[2]}-${e[1]}-${e[0]}`),""==t.get("new_password")?t.delete("new_password"):a=!0,$("#formEditProfile button#submit #text").addClass("d-none"),$("#formEditProfile button#submit #spinner").removeClass("d-none"),axios.put(`${APIURL}/admin/editprofile`,t,{headers:{token:TOKEN}}).then(e=>{$("#formEditProfile button#submit #text").removeClass("d-none"),$("#formEditProfile button#submit #spinner").addClass("d-none"),$("#newpass-edit").val(""),$("#oldpass-edit").val("");let i={};for(var s of t.entries())i[s[0]]=s[1];dataAdmin=i,updatePersonalInfo(i),showAlert({message:"<strong>Success...</strong> edit profile berhasil!",autohide:!0,type:"success"}),setTimeout(()=>{a&&Swal.fire({icon:"info",title:"<strong>INFO</strong>",html:"Password telah diupdate, silahkan login ulang",showCancelButton:!1,confirmButtonText:"ok"}).then(()=>{doLogout()})},2e3)}).catch(e=>{$("#formEditProfile button#submit #text").removeClass("d-none"),$("#formEditProfile button#submit #spinner").addClass("d-none"),400==e.response.status?(e.response.data.messages.username&&($("#username-edit").addClass("is-invalid"),$("#username-edit-error").text("*"+e.response.data.messages.username)),e.response.data.messages.notelp&&($("#notelp-edit").addClass("is-invalid"),$("#notelp-edit-error").text("*"+e.response.data.messages.notelp)),e.response.data.messages.old_password&&($("#oldpass-edit").addClass("is-invalid"),$("#oldpass-edit-error").text("*"+e.response.data.messages.old_password))):401==e.response.status?"token expired"==e.response.data.messages?Swal.fire({icon:"error",title:"<strong>LOGIN EXPIRED</strong>",text:"silahkan login ulang untuk perbaharui login anda",showCancelButton:!1,confirmButtonText:"ok"}).then(()=>{document.cookie="token=null;expires=;path=/;",window.location.replace(`${BASEURL}/login`)}):(document.cookie="token=null;expires=;path=/;",window.location.replace(`${BASEURL}/login`)):500==e.response.status&&showAlert({message:"<strong>Ups . . .</strong> terjadi kesalahan pada server, coba sekali lagi",autohide:!0,type:"danger"})})}});